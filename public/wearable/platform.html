<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DANZ Wearable — Platform.IO Hardware</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink: #ec4899;
            --pink-dark: #db2777;
            --purple: #a855f7;
            --purple-dark: #7c3aed;
            --cyan: #06b6d4;
            --green: #22c55e;
            --amber: #f59e0b;
            --red: #ef4444;
            --blue: #3b82f6;
            --gold: #d4a017;
            --dark: #050507;
            --dark-2: #0a0a10;
            --dark-3: #111118;
            --surface: #16161f;
            --surface-2: #1e1e2a;
            --text: #f0f0f5;
            --text-dim: #6b6b80;
            --mono: 'JetBrains Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--dark);
            color: var(--text);
            overflow-x: hidden;
        }

        /* ── Password ── */
        #gate {
            position: fixed; inset: 0; background: var(--dark);
            display: flex; align-items: center; justify-content: center;
            z-index: 9999; transition: opacity .5s, visibility .5s;
        }
        #gate.gone { opacity: 0; visibility: hidden; pointer-events: none; }
        .gate-box {
            text-align: center; padding: 50px; width: 90%; max-width: 400px;
            background: var(--surface); border-radius: 24px;
            border: 1px solid rgba(236,72,153,.2);
        }
        .gate-logo { font-size: 42px; font-weight: 900; background: linear-gradient(135deg,var(--pink),var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gate-sub { color: var(--text-dim); margin: 8px 0 30px; font-size: 14px; }
        .gate-input {
            width: 100%; padding: 16px; border: 2px solid rgba(236,72,153,.25);
            border-radius: 12px; background: var(--dark); color: var(--text);
            font-size: 16px; text-align: center; letter-spacing: 3px;
            font-family: 'Outfit'; transition: border-color .3s;
        }
        .gate-input:focus { outline: none; border-color: var(--pink); }
        .gate-input::placeholder { letter-spacing: 0; color: var(--text-dim); }
        .gate-btn {
            width: 100%; padding: 16px; margin-top: 16px; border: none; border-radius: 12px;
            background: linear-gradient(135deg,var(--pink),var(--purple));
            color: #fff; font-size: 16px; font-weight: 600; cursor: pointer;
            transition: transform .2s, box-shadow .2s;
        }
        .gate-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(236,72,153,.4); }
        .gate-err { color: var(--red); font-size: 13px; margin-top: 12px; opacity: 0; transition: opacity .3s; }
        .gate-err.on { opacity: 1; }

        /* ── App ── */
        #app { display: none; }
        #app.on { display: block; }

        /* ── Top Bar ── */
        .topbar {
            position: fixed; top: 0; left: 0; right: 0; z-index: 200;
            padding: 16px 32px; display: flex; justify-content: space-between; align-items: center;
            background: linear-gradient(180deg, rgba(5,5,7,.97) 0%, rgba(5,5,7,.6) 70%, transparent 100%);
            backdrop-filter: blur(12px);
        }
        .topbar-left { display: flex; align-items: baseline; gap: 12px; }
        .topbar-brand { font-size: 22px; font-weight: 900; background: linear-gradient(135deg,var(--pink),var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .topbar-tag { font-family: var(--mono); font-size: 10px; color: var(--cyan); letter-spacing: 2px; text-transform: uppercase; }
        .topbar-right { display: flex; gap: 8px; align-items: center; }
        .topbar-chip {
            font-family: var(--mono); font-size: 11px; padding: 5px 14px;
            border-radius: 16px; border: 1px solid rgba(6,182,212,.25);
            color: var(--cyan); background: rgba(6,182,212,.05);
        }
        .topbar-ver {
            font-family: var(--mono); font-size: 9px; padding: 4px 10px;
            border-radius: 12px; border: 1px solid rgba(236,72,153,.2);
            color: var(--pink); background: rgba(236,72,153,.05);
        }

        /* ── 3D Hero ── */
        .hero { position: relative; height: 100vh; overflow: hidden; }
        #viewer { width: 100%; height: 100%; cursor: grab; }
        #viewer:active { cursor: grabbing; }

        /* Animated gradient mesh behind model */
        .hero-mesh {
            position: absolute; inset: 0; z-index: 0; pointer-events: none; opacity: .35;
            background:
                radial-gradient(ellipse 50% 40% at 20% 60%, rgba(168,85,247,.25), transparent),
                radial-gradient(ellipse 40% 50% at 80% 30%, rgba(236,72,153,.2), transparent),
                radial-gradient(ellipse 60% 30% at 50% 80%, rgba(6,182,212,.15), transparent);
            animation: meshShift 12s ease-in-out infinite alternate;
        }
        @keyframes meshShift {
            0% { filter: hue-rotate(0deg); transform: scale(1); }
            100% { filter: hue-rotate(20deg); transform: scale(1.1); }
        }

        .loader {
            position: absolute; inset: 0; background: var(--dark);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 50; transition: opacity .8s;
        }
        .loader.gone { opacity: 0; pointer-events: none; }
        .spinner { width: 48px; height: 48px; border: 3px solid rgba(236,72,153,.15); border-top-color: var(--pink); border-radius: 50%; animation: spin .8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader-text { margin-top: 16px; font-family: var(--mono); font-size: 12px; color: var(--text-dim); letter-spacing: 2px; }

        /* ── Hero Overlay ── */
        .hero-info {
            position: absolute; top: 100px; left: 40px; z-index: 10;
            max-width: 420px; pointer-events: none;
        }
        .hero-eyebrow {
            font-family: var(--mono); font-size: 11px; letter-spacing: 4px;
            text-transform: uppercase; color: var(--cyan); margin-bottom: 12px;
            display: flex; align-items: center; gap: 8px;
        }
        .hero-eyebrow::before {
            content: ''; width: 24px; height: 1px; background: var(--cyan);
        }
        .hero-title { font-size: 52px; font-weight: 900; line-height: 1.05; margin-bottom: 16px; }
        .hero-title em { font-style: normal; background: linear-gradient(135deg,var(--pink),var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hero-desc { font-size: 15px; color: var(--text-dim); line-height: 1.7; margin-bottom: 28px; }
        .hero-stats { display: flex; gap: 32px; }
        .stat { position: relative; }
        .stat-val { font-family: var(--mono); font-size: 26px; font-weight: 700; color: var(--pink); }
        .stat-label { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-top: 2px; }
        .stat-bar { position: absolute; bottom: -6px; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg,var(--pink),transparent); border-radius: 1px; }

        /* Floating hint at bottom of hero */
        .hero-hint {
            position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%);
            font-family: var(--mono); font-size: 10px; color: var(--text-dim);
            letter-spacing: 2px; text-transform: uppercase; z-index: 10;
            pointer-events: none; animation: hintPulse 2.5s ease-in-out infinite;
        }
        @keyframes hintPulse { 0%,100% { opacity: .4; } 50% { opacity: .8; } }

        /* ── Specs Ticker ── */
        .ticker-wrap {
            position: relative; z-index: 2; overflow: hidden;
            background: var(--surface); border-top: 1px solid rgba(236,72,153,.08);
            border-bottom: 1px solid rgba(236,72,153,.08);
            padding: 14px 0;
        }
        .ticker {
            display: flex; gap: 48px; white-space: nowrap;
            animation: tickerScroll 30s linear infinite;
        }
        .ticker-item {
            display: flex; align-items: center; gap: 8px;
            font-family: var(--mono); font-size: 11px; color: var(--text-dim);
        }
        .ticker-val { color: var(--cyan); font-weight: 600; }
        .ticker-sep { color: rgba(236,72,153,.3); }
        @keyframes tickerScroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* ── Component Dock ── */
        .dock {
            position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 4px; padding: 6px;
            background: rgba(10,10,16,.92); backdrop-filter: blur(24px);
            border-radius: 18px; border: 1px solid rgba(236,72,153,.12);
            z-index: 100; overflow-x: auto; max-width: 95vw;
        }
        .dock-btn {
            padding: 8px 14px; border-radius: 12px; border: 1px solid transparent;
            background: transparent; color: var(--text-dim); cursor: pointer;
            font-family: var(--mono); font-size: 10px; letter-spacing: .5px;
            white-space: nowrap; transition: all .25s; display: flex; align-items: center; gap: 6px;
        }
        .dock-btn:hover { color: var(--text); background: rgba(255,255,255,.04); }
        .dock-btn.on { color: #fff; background: rgba(236,72,153,.18); border-color: rgba(236,72,153,.35); }
        .dock-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }

        /* ── Sidebar Panel ── */
        .panel {
            position: fixed; right: 0; top: 0; bottom: 0; width: 420px; max-width: 92vw;
            background: rgba(10,10,16,.96); backdrop-filter: blur(30px);
            border-left: 1px solid rgba(236,72,153,.12);
            z-index: 300; transform: translateX(100%);
            transition: transform .35s cubic-bezier(.16,1,.3,1);
            overflow-y: auto;
        }
        .panel.open { transform: translateX(0); }
        .panel::-webkit-scrollbar { width: 3px; }
        .panel::-webkit-scrollbar-thumb { background: rgba(236,72,153,.25); border-radius: 2px; }

        .panel-head {
            position: sticky; top: 0; z-index: 5; padding: 28px 28px 20px;
            background: rgba(10,10,16,.98); border-bottom: 1px solid rgba(255,255,255,.04);
        }
        .panel-x {
            position: absolute; top: 22px; right: 22px;
            width: 32px; height: 32px; border-radius: 8px;
            background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.08);
            color: var(--text-dim); font-size: 16px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all .2s;
        }
        .panel-x:hover { background: rgba(239,68,68,.15); border-color: var(--red); color: var(--red); }
        .panel-cat { font-family: var(--mono); font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--cyan); margin-bottom: 6px; }
        .panel-title { font-size: 24px; font-weight: 700; }
        .panel-id { font-family: var(--mono); font-size: 11px; color: var(--text-dim); margin-top: 4px; letter-spacing: .5px; }

        .panel-body { padding: 20px 28px 40px; }
        .panel-desc { font-size: 14px; color: var(--text-dim); line-height: 1.8; margin-bottom: 20px; }

        .prio { display: inline-block; font-family: var(--mono); font-size: 10px; padding: 3px 10px; border-radius: 4px; font-weight: 600; margin-bottom: 16px; }
        .prio-p0 { background: rgba(239,68,68,.12); color: var(--red); border: 1px solid rgba(239,68,68,.25); }
        .prio-p1 { background: rgba(245,158,11,.12); color: var(--amber); border: 1px solid rgba(245,158,11,.25); }
        .prio-p2 { background: rgba(6,182,212,.12); color: var(--cyan); border: 1px solid rgba(6,182,212,.25); }

        .sblock { margin-bottom: 24px; }
        .sblock-title { font-family: var(--mono); font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: var(--purple); margin-bottom: 12px; padding-bottom: 6px; border-bottom: 1px solid rgba(168,85,247,.12); }
        .srow { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,.02); }
        .srow-k { font-size: 13px; color: var(--text-dim); }
        .srow-v { font-family: var(--mono); font-size: 13px; color: var(--text); font-weight: 500; }

        .chips { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .chip { font-family: var(--mono); font-size: 10px; padding: 4px 10px; border-radius: 5px; background: rgba(168,85,247,.08); border: 1px solid rgba(168,85,247,.18); color: var(--purple); }

        /* Panel use cases */
        .panel-uses { margin-top: 8px; }
        .panel-use { display: flex; align-items: baseline; gap: 8px; padding: 4px 0; font-size: 12px; color: var(--text-dim); }
        .panel-use::before { content: '\2192'; color: var(--pink); font-size: 10px; flex-shrink: 0; }

        /* ── Scroll Sections ── */
        .sections { position: relative; z-index: 1; }
        .sec { padding: 100px 48px; max-width: 1100px; margin: 0 auto; }
        .sec-head { text-align: center; margin-bottom: 56px; }
        .sec-head h2 { font-size: 40px; font-weight: 800; margin-bottom: 12px; }
        .sec-head h2 em { font-style: normal; background: linear-gradient(135deg,var(--pink),var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .sec-head p { font-size: 16px; color: var(--text-dim); max-width: 520px; margin: 0 auto; }

        /* Section divider */
        .sec-div {
            width: 60px; height: 2px; margin: 0 auto 60px;
            background: linear-gradient(90deg,var(--pink),var(--purple));
            border-radius: 1px;
        }

        /* Architecture Cards */
        .arch-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .acard {
            background: var(--surface); border-radius: 16px; padding: 28px;
            border: 1px solid rgba(236,72,153,.06);
            transition: all .35s; position: relative; overflow: hidden;
        }
        .acard:hover { transform: translateY(-4px); border-color: rgba(236,72,153,.2); box-shadow: 0 16px 40px rgba(0,0,0,.35); }
        .acard-glow {
            position: absolute; top: -30px; right: -30px; width: 80px; height: 80px;
            border-radius: 50%; opacity: 0; transition: opacity .35s; pointer-events: none;
        }
        .acard:hover .acard-glow { opacity: .15; }
        .acard-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; margin-bottom: 16px; }
        .acard-fr { position: absolute; top: 16px; right: 16px; font-family: var(--mono); font-size: 9px; color: var(--text-dim); letter-spacing: 1px; padding: 2px 8px; border-radius: 4px; background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.05); }
        .acard h3 { font-size: 16px; font-weight: 700; margin-bottom: 6px; }
        .acard p { font-size: 13px; color: var(--text-dim); line-height: 1.6; }
        .acard-specs { margin-top: 14px; }
        .acard-spec { display: flex; justify-content: space-between; padding: 4px 0; font-size: 11px; border-bottom: 1px solid rgba(255,255,255,.03); }
        .acard-spec span:first-child { color: var(--text-dim); }
        .acard-spec span:last-child { font-family: var(--mono); color: var(--cyan); }
        .acard-use { font-size: 10px; color: var(--pink); margin-top: 10px; font-family: var(--mono); letter-spacing: .5px; opacity: .7; }

        /* ── Functional Requirements ── */
        .fr-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .fr-item {
            display: flex; align-items: flex-start; gap: 14px; padding: 18px;
            background: var(--surface); border-radius: 12px;
            border: 1px solid rgba(255,255,255,.03); transition: border-color .3s;
        }
        .fr-item:hover { border-color: rgba(236,72,153,.15); }
        .fr-badge {
            flex-shrink: 0; font-family: var(--mono); font-size: 9px; font-weight: 700;
            padding: 3px 8px; border-radius: 4px; letter-spacing: .5px;
        }
        .fr-badge.p0 { background: rgba(239,68,68,.12); color: var(--red); border: 1px solid rgba(239,68,68,.2); }
        .fr-badge.p1 { background: rgba(245,158,11,.12); color: var(--amber); border: 1px solid rgba(245,158,11,.2); }
        .fr-badge.p2 { background: rgba(6,182,212,.12); color: var(--cyan); border: 1px solid rgba(6,182,212,.2); }
        .fr-id { font-family: var(--mono); font-size: 11px; color: var(--text); font-weight: 600; margin-bottom: 2px; }
        .fr-desc { font-size: 12px; color: var(--text-dim); line-height: 1.5; }

        /* ── Non-Functional Requirements (metrics strip) ── */
        .nfr-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .nfr-card {
            text-align: center; padding: 28px 20px; border-radius: 16px;
            background: var(--surface); border: 1px solid rgba(236,72,153,.06);
            transition: all .35s;
        }
        .nfr-card:hover { transform: translateY(-3px); border-color: rgba(236,72,153,.15); }
        .nfr-val { font-family: var(--mono); font-size: 32px; font-weight: 800; margin-bottom: 6px; }
        .nfr-label { font-size: 12px; color: var(--text-dim); margin-bottom: 4px; }
        .nfr-detail { font-family: var(--mono); font-size: 10px; color: var(--cyan); letter-spacing: .5px; }

        /* RTOS Table */
        .rtable { background: var(--surface); border-radius: 16px; overflow: hidden; margin-top: 32px; }
        .rrow { display: grid; grid-template-columns: 1.5fr .8fr 1fr 1fr; border-bottom: 1px solid rgba(255,255,255,.03); }
        .rrow.rhead { background: rgba(236,72,153,.06); }
        .rrow.rhead .rcell { font-family: var(--mono); font-size: 10px; letter-spacing: 1px; text-transform: uppercase; color: var(--pink); }
        .rcell { padding: 14px 20px; font-size: 13px; color: var(--text-dim); }
        .rrow:not(.rhead) .rcell:first-child { color: var(--text); font-weight: 500; }
        .rrow:last-child { border-bottom: none; }

        /* IBC Feature */
        .ibc-card {
            background: var(--surface); border-radius: 24px; padding: 48px;
            border: 1px solid rgba(236,72,153,.15); position: relative; overflow: hidden;
            margin-top: 32px;
        }
        .ibc-card::after {
            content: ''; position: absolute; top: -80px; right: -80px;
            width: 250px; height: 250px;
            background: radial-gradient(circle, rgba(236,72,153,.08) 0%, transparent 70%);
        }
        .ibc-card::before {
            content: ''; position: absolute; bottom: -60px; left: -60px;
            width: 200px; height: 200px;
            background: radial-gradient(circle, rgba(6,182,212,.06) 0%, transparent 70%);
        }
        .ibc-card h3 { font-size: 24px; font-weight: 700; margin-bottom: 12px; position: relative; }
        .ibc-card h3 em { font-style: normal; background: linear-gradient(135deg,var(--pink),var(--amber)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .ibc-card > p { font-size: 14px; color: var(--text-dim); line-height: 1.8; margin-bottom: 24px; max-width: 600px; position: relative; }
        .ibc-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; position: relative; }
        .ibc-item { padding: 16px; border-radius: 10px; background: rgba(5,5,7,.5); border: 1px solid rgba(236,72,153,.08); transition: border-color .3s; }
        .ibc-item:hover { border-color: rgba(236,72,153,.2); }
        .ibc-item .il { font-family: var(--mono); font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: var(--pink); margin-bottom: 4px; }
        .ibc-item .iv { font-size: 13px; color: var(--text); }

        /* ── Software Architecture ── */
        .sw-card {
            background: var(--surface); border-radius: 16px; padding: 32px;
            border: 1px solid rgba(6,182,212,.1); margin-top: 32px;
            font-family: var(--mono);
        }
        .sw-tree { font-size: 12px; line-height: 2.2; color: var(--text-dim); }
        .sw-tree .dir { color: var(--cyan); }
        .sw-tree .file { color: var(--text); }
        .sw-tree .comment { color: rgba(236,72,153,.5); font-style: italic; }

        /* ── Open Questions / Risks ── */
        .risk-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; margin-top: 32px; }
        .risk-item {
            padding: 20px; border-radius: 12px; background: var(--surface);
            border-left: 3px solid var(--amber); transition: all .3s;
        }
        .risk-item:hover { transform: translateX(4px); }
        .risk-tag { font-family: var(--mono); font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: var(--amber); margin-bottom: 6px; }
        .risk-q { font-size: 13px; color: var(--text); font-weight: 500; margin-bottom: 6px; }
        .risk-detail { font-size: 11px; color: var(--text-dim); line-height: 1.6; }

        /* Milestones */
        .miles { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; margin-top: 32px; position: relative; }
        .miles::before { content:''; position: absolute; top: 38px; left: 24px; right: 24px; height: 2px; background: linear-gradient(90deg,var(--pink),var(--purple),var(--cyan)); opacity: .15; }
        .mile {
            text-align: center; position: relative; padding: 14px 6px;
            border-radius: 12px; background: var(--surface); border: 1px solid rgba(236,72,153,.04);
            transition: all .3s;
        }
        .mile:hover { border-color: rgba(236,72,153,.15); transform: translateY(-3px); }
        .mile-dot { width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(135deg,var(--pink),var(--purple)); margin: 10px auto 10px; position: relative; z-index: 1; box-shadow: 0 0 16px rgba(236,72,153,.35); }
        .mile-id { font-family: var(--mono); font-size: 10px; color: var(--pink); letter-spacing: 1px; }
        .mile-desc { font-size: 11px; color: var(--text); font-weight: 600; margin-bottom: 4px; }
        .mile-full { font-size: 10px; color: var(--text-dim); line-height: 1.4; padding: 0 2px; }
        .mile-time { font-family: var(--mono); font-size: 10px; color: var(--cyan); margin-top: 6px; }

        /* Footer */
        .foot { padding: 48px; text-align: center; border-top: 1px solid rgba(236,72,153,.08); }
        .foot-logo { font-size: 28px; font-weight: 900; background: linear-gradient(135deg,var(--pink),var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 8px; }
        .foot p { color: var(--text-dim); font-size: 13px; }
        .foot-tech { font-family: var(--mono); font-size: 10px; color: rgba(255,255,255,.1); margin-top: 6px; letter-spacing: 2px; }
        .foot-links { display: flex; justify-content: center; gap: 24px; margin-top: 16px; }
        .foot-link { font-family: var(--mono); font-size: 11px; color: var(--text-dim); text-decoration: none; transition: color .2s; }
        .foot-link:hover { color: var(--pink); }

        /* ── Scroll reveal ── */
        .reveal { opacity: 0; transform: translateY(16px); transition: opacity .5s, transform .5s; }
        .reveal.vis { opacity: 1; transform: none; }

        /* stagger delays for grids */
        .reveal-d1 { transition-delay: .05s; }
        .reveal-d2 { transition-delay: .1s; }
        .reveal-d3 { transition-delay: .15s; }
        .reveal-d4 { transition-delay: .2s; }
        .reveal-d5 { transition-delay: .25s; }

        /* ── Responsive ── */
        @media (max-width: 1024px) {
            .arch-grid { grid-template-columns: repeat(2, 1fr); }
            .ibc-grid { grid-template-columns: 1fr; }
            .fr-grid { grid-template-columns: 1fr; }
            .nfr-grid { grid-template-columns: repeat(2, 1fr); }
            .risk-grid { grid-template-columns: 1fr; }
            .miles { grid-template-columns: repeat(4, 1fr); }
            .hero-info { max-width: 300px; }
            .hero-title { font-size: 38px; }
        }
        @media (max-width: 768px) {
            .topbar { padding: 12px 16px; }
            .topbar-right { display: none; }
            .hero-info { top: 80px; left: 20px; max-width: 240px; }
            .hero-title { font-size: 28px; }
            .hero-desc { font-size: 13px; }
            .hero-stats { gap: 16px; }
            .stat-val { font-size: 20px; }
            .arch-grid { grid-template-columns: 1fr; }
            .nfr-grid { grid-template-columns: 1fr; }
            .sec { padding: 64px 20px; }
            .sec-head h2 { font-size: 28px; }
            .rrow { grid-template-columns: 1fr 1fr; }
            .miles { grid-template-columns: repeat(2, 1fr); }
            .miles::before { display: none; }
            .ibc-card { padding: 24px; }
            .dock-btn { padding: 6px 10px; font-size: 9px; }
        }
    </style>
</head>
<body>
    <!-- Password Gate -->
    <div id="gate">
        <div class="gate-box">
            <div class="gate-logo">DANZ</div>
            <p class="gate-sub">Enter access code</p>
            <input type="password" id="pw" class="gate-input" placeholder="Access Code" autocomplete="off">
            <button class="gate-btn" id="pw-btn">Enter</button>
            <p class="gate-err" id="pw-err">Incorrect code</p>
        </div>
    </div>

    <div id="app">
        <!-- Top Bar -->
        <nav class="topbar">
            <div class="topbar-left">
                <span class="topbar-brand">DANZ</span>
                <span class="topbar-tag">Wearable Platform</span>
            </div>
            <div class="topbar-right">
                <span class="topbar-chip">nRF5340 &middot; Zephyr RTOS</span>
                <span class="topbar-ver">PRD v1.0</span>
            </div>
        </nav>

        <!-- 3D Hero -->
        <section class="hero">
            <div class="hero-mesh"></div>
            <canvas id="viewer"></canvas>
            <div class="loader" id="loader">
                <div class="spinner"></div>
                <div class="loader-text">Loading 3D Model...</div>
            </div>
            <div class="hero-info">
                <div class="hero-eyebrow">Platform.IO Wearable Device</div>
                <h1 class="hero-title">Your Body.<br><em>The Network.</em></h1>
                <p class="hero-desc">Multi-sensor IoT wearable with galvanic intra-body communication. The DANZ case houses 12 subsystems powered by the nRF5340 dual-core SoC.</p>
                <div class="hero-stats">
                    <div class="stat"><div class="stat-val" data-count="12">12</div><div class="stat-label">Subsystems</div><div class="stat-bar"></div></div>
                    <div class="stat"><div class="stat-val">8+h</div><div class="stat-label">Battery Life</div><div class="stat-bar"></div></div>
                    <div class="stat"><div class="stat-val">1 Mbps</div><div class="stat-label">IBC Rate</div><div class="stat-bar"></div></div>
                    <div class="stat"><div class="stat-val">128 MHz</div><div class="stat-label">App Core</div><div class="stat-bar"></div></div>
                </div>
            </div>
            <div class="hero-hint">Click &middot; Drag &middot; Scroll to explore</div>
        </section>

        <!-- Specs Ticker -->
        <div class="ticker-wrap">
            <div class="ticker" id="ticker"></div>
        </div>

        <!-- Component Dock -->
        <div class="dock" id="dock"></div>

        <!-- Detail Panel -->
        <div class="panel" id="panel">
            <div class="panel-head">
                <button class="panel-x" id="panel-x">&times;</button>
                <div class="panel-cat" id="p-cat"></div>
                <div class="panel-title" id="p-title"></div>
                <div class="panel-id" id="p-id"></div>
            </div>
            <div class="panel-body" id="p-body"></div>
        </div>

        <!-- Scroll Content -->
        <div class="sections">

            <!-- System Performance Metrics -->
            <section class="sec">
                <div class="sec-head">
                    <h2>System <em>Performance</em></h2>
                    <p>Non-functional requirements that define the platform's operating envelope</p>
                </div>
                <div class="nfr-grid" id="nfr-grid"></div>
            </section>

            <!-- Hardware Architecture -->
            <section class="sec">
                <div class="sec-head">
                    <h2>Hardware <em>Architecture</em></h2>
                    <p>12 subsystems on a dual-core ARM Cortex-M33 inside the DANZ case</p>
                </div>
                <div class="arch-grid" id="arch-grid"></div>
            </section>

            <!-- Functional Requirements -->
            <section class="sec">
                <div class="sec-head">
                    <h2>Functional <em>Requirements</em></h2>
                    <p>11 functional requirements across three priority tiers</p>
                </div>
                <div class="fr-grid" id="fr-grid"></div>
            </section>

            <!-- RTOS Thread Map -->
            <section class="sec">
                <div class="sec-head">
                    <h2>RTOS <em>Thread Map</em></h2>
                    <p>Zephyr task scheduling with priority-based preemptive execution</p>
                </div>
                <div class="rtable">
                    <div class="rrow rhead"><div class="rcell">Thread</div><div class="rcell">Priority</div><div class="rcell">Stack</div><div class="rcell">Interval</div></div>
                    <div class="rrow reveal"><div class="rcell">IBC RX</div><div class="rcell" style="color:var(--red);font-family:var(--mono)">0 (highest)</div><div class="rcell" style="font-family:var(--mono)">2048 B</div><div class="rcell" style="font-family:var(--mono)">IRQ-driven</div></div>
                    <div class="rrow reveal"><div class="rcell">Sensor Sampling</div><div class="rcell" style="color:var(--amber);font-family:var(--mono)">2</div><div class="rcell" style="font-family:var(--mono)">1024 B</div><div class="rcell" style="font-family:var(--mono)">50 ms</div></div>
                    <div class="rrow reveal"><div class="rcell">BLE Notifications</div><div class="rcell" style="color:var(--cyan);font-family:var(--mono)">3</div><div class="rcell" style="font-family:var(--mono)">1024 B</div><div class="rcell" style="font-family:var(--mono)">100 ms</div></div>
                    <div class="rrow reveal"><div class="rcell">LED / Haptic</div><div class="rcell" style="color:var(--purple);font-family:var(--mono)">5</div><div class="rcell" style="font-family:var(--mono)">512 B</div><div class="rcell" style="font-family:var(--mono)">On event</div></div>
                    <div class="rrow reveal"><div class="rcell">USB CDC Logger</div><div class="rcell" style="color:var(--green);font-family:var(--mono)">7 (lowest)</div><div class="rcell" style="font-family:var(--mono)">1024 B</div><div class="rcell" style="font-family:var(--mono)">On demand</div></div>
                </div>
            </section>

            <!-- IBC Deep Dive -->
            <section class="sec">
                <div class="sec-head">
                    <h2>Intra-Body <em>Communication</em></h2>
                    <p>Galvanic coupling turns your body into a secure data network</p>
                </div>
                <div class="ibc-card">
                    <h3>Your Body is the <em>Network</em></h3>
                    <p>IBC transmits data between wearable devices on different body parts via differential signal injection through skin electrodes. No RF required &mdash; the human body itself becomes the communication channel.</p>
                    <div class="ibc-grid">
                        <div class="ibc-item reveal"><div class="il">Method</div><div class="iv">Galvanic coupling &mdash; differential signal via skin electrodes</div></div>
                        <div class="ibc-item reveal"><div class="il">Frequency</div><div class="iv">100 kHz &ndash; 2 MHz (channel-adaptive)</div></div>
                        <div class="ibc-item reveal"><div class="il">Data Rate</div><div class="iv">Up to 1 Mbps (channel-dependent)</div></div>
                        <div class="ibc-item reveal"><div class="il">Modulation</div><div class="iv">ASK / FSK / OOK (TBD via characterization)</div></div>
                        <div class="ibc-item reveal"><div class="il">Electrodes</div><div class="iv">2-electrode differential (TX+/TX&minus;, RX+/RX&minus;)</div></div>
                        <div class="ibc-item reveal"><div class="il">Signal Gen</div><div class="iv">nRF5340 PWM/Timer + external analog front-end</div></div>
                        <div class="ibc-item reveal"><div class="il">Reception</div><div class="iv">Amplifier + filter &rarr; ADC or comparator</div></div>
                        <div class="ibc-item reveal"><div class="il">Isolation</div><div class="iv">Coupling capacitors block DC; AC-coupled differential</div></div>
                        <div class="ibc-item reveal"><div class="il">Safety</div><div class="iv">&lt;1V peak, current limited, no DC path through body</div></div>
                        <div class="ibc-item reveal"><div class="il">Protocol</div><div class="iv">Preamble + Device ID + Payload + CRC16 | CSMA/CA</div></div>
                        <div class="ibc-item reveal"><div class="il">IBC Stack</div><div class="iv">Dedicated Zephyr thread, priority 0 (highest)</div></div>
                        <div class="ibc-item reveal"><div class="il">Use Cases</div><div class="iv">Device handshake, body area network, SOS relay, identity</div></div>
                    </div>
                </div>
            </section>

            <!-- Software Architecture -->
            <section class="sec">
                <div class="sec-head">
                    <h2>Software <em>Architecture</em></h2>
                    <p>Platform.IO + Zephyr RTOS project structure with nRF Connect SDK</p>
                </div>
                <div class="sw-card reveal">
                    <div class="sw-tree">
                        <span class="dir">flowbond-wearable/</span><br>
                        &nbsp;&nbsp;<span class="file">platformio.ini</span> <span class="comment">// board: nrf5340dk, framework: zephyr</span><br>
                        &nbsp;&nbsp;<span class="dir">src/</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="file">main.c</span> <span class="comment">// kernel init, thread spawn</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="dir">sensors/</span> <span class="comment">// IMU, AHT10, capacitive touch</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="dir">ble/</span> <span class="comment">// GATT service, advertising, OTA DFU</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="dir">ibc/</span> <span class="comment">// galvanic TX/RX driver, protocol stack</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="dir">haptic/</span> <span class="comment">// vibration patterns, DRV2605L</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="dir">led/</span> <span class="comment">// WS2812B driver, animation FSM</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="dir">nfc/</span> <span class="comment">// NDEF tag content management</span><br>
                        &nbsp;&nbsp;<span class="dir">boards/</span> <span class="comment">// custom .overlay, device tree</span><br>
                        &nbsp;&nbsp;<span class="dir">test/</span> <span class="comment">// unity test harness</span><br>
                    </div>
                </div>

                <!-- Toolchain Table -->
                <div class="rtable" style="margin-top: 20px;">
                    <div class="rrow rhead"><div class="rcell">Component</div><div class="rcell">Selection</div><div class="rcell">Notes</div><div class="rcell">Version</div></div>
                    <div class="rrow reveal"><div class="rcell">IDE / Build</div><div class="rcell" style="font-family:var(--mono)">Platform.IO</div><div class="rcell">VS Code + CLI</div><div class="rcell" style="font-family:var(--mono)">Latest</div></div>
                    <div class="rrow reveal"><div class="rcell">SoC</div><div class="rcell" style="font-family:var(--mono)">nRF5340</div><div class="rcell">Dual Cortex-M33</div><div class="rcell" style="font-family:var(--mono)">128+64 MHz</div></div>
                    <div class="rrow reveal"><div class="rcell">RTOS</div><div class="rcell" style="font-family:var(--mono)">Zephyr</div><div class="rcell">via nRF Connect SDK</div><div class="rcell" style="font-family:var(--mono)">3.x</div></div>
                    <div class="rrow reveal"><div class="rcell">Language</div><div class="rcell" style="font-family:var(--mono)">C / C++</div><div class="rcell">Zephyr device tree HAL</div><div class="rcell" style="font-family:var(--mono)">C11</div></div>
                    <div class="rrow reveal"><div class="rcell">Debugger</div><div class="rcell" style="font-family:var(--mono)">J-Link</div><div class="rcell">Also OpenOCD</div><div class="rcell" style="font-family:var(--mono)">Integrated</div></div>
                </div>
            </section>

            <!-- Open Questions & Risks -->
            <section class="sec">
                <div class="sec-head">
                    <h2>Open <em>Questions</em></h2>
                    <p>Active investigation items from the PRD risk register</p>
                </div>
                <div class="risk-grid" id="risk-grid"></div>
            </section>

            <!-- Development Roadmap -->
            <section class="sec">
                <div class="sec-head">
                    <h2>Development <em>Roadmap</em></h2>
                    <p>10-week bring-up from toolchain to custom PCB fabrication</p>
                </div>
                <div class="miles" id="miles-grid"></div>
            </section>
        </div>

        <footer class="foot">
            <div class="foot-logo">DANZ</div>
            <p>&copy; 2026 FlowBond Technologies. All rights reserved.</p>
            <p class="foot-tech">PLATFORM.IO &middot; nRF5340 &middot; ZEPHYR RTOS &middot; GALVANIC IBC &middot; BLE 5.3 &middot; NFC-A</p>
            <div class="foot-links">
                <span class="foot-link">PRD v1.0</span>
                <span class="foot-link">February 2026</span>
                <span class="foot-link">CONFIDENTIAL</span>
            </div>
        </footer>
    </div>

    <script type="importmap">
    { "imports": {
        "three": "https://unpkg.com/three@0.162.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.162.0/examples/jsm/"
    }}
    </script>
    <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

    /* ── Component Data (expanded from PRD) ── */
    const C = {
        soc: {
            name:'nRF5340 SoC', cat:'CORE PROCESSOR', id:'PRIMARY SoC', color:'#7c3aed', mesh:'nRF5340_SoC', prio:'P0',
            desc:'Dual-core ARM Cortex-M33 running Zephyr RTOS. App core at 128 MHz handles sensor fusion, IBC protocol, and haptic control. Net core at 64 MHz manages BLE 5.3 stack and NFC. Built with Platform.IO + nRF Connect SDK.',
            blocks:[
                {t:'Processor',rows:[['Architecture','ARM Cortex-M33 (dual-core)'],['App Core','128 MHz'],['Net Core','64 MHz'],['RTOS','Zephyr (nRF Connect SDK)'],['Flash','1 MB + 256 KB'],['RAM','512 KB + 64 KB']]},
                {t:'Development',rows:[['IDE','Platform.IO (VS Code + CLI)'],['Language','C / C++ (C11)'],['Debugger','J-Link / OpenOCD'],['CI','cppcheck / clang-tidy'],['OTA','SMP / mcumgr DFU']]}
            ],
            chips:['ARM Cortex-M33','Zephyr','Platform.IO','nRF Connect SDK'],
            uses:['Sensor data fusion','IBC protocol processing','BLE stack management','Power management']
        },
        imu: {
            name:'6-Axis IMU', cat:'MOTION SENSOR', id:'FR-01', color:'#22c55e', mesh:'IMU_ICM42688', prio:'P0',
            desc:'3-axis accelerometer + 3-axis gyroscope with FIFO buffering and interrupt-driven wakeup. Minimum 50 Hz sampling rate with configurable ODR. Used for motion detection, gesture recognition, and activity tracking.',
            blocks:[
                {t:'Accelerometer',rows:[['Range','\u00b12g to \u00b116g (configurable)'],['Mode','Low-power with interrupt wakeup'],['ODR','Up to 1.6 kHz']]},
                {t:'Gyroscope',rows:[['Range','\u00b1250 to \u00b12000 dps'],['Interface','SPI or I2C'],['Buffering','Hardware FIFO']]},
                {t:'Software',rows:[['Sampling','\u226550 Hz (configurable)'],['Events','Motion detection, tap, freefall'],['Thread','Sensor Sampling (priority 2)']]}
            ],
            chips:['ICM-42688-P','LSM6DSO','BMI270'],
            uses:['Step counting','Gesture recognition','Activity tracking','Motion-triggered wakeup']
        },
        touch: {
            name:'Capacitive Touch', cat:'SKIN SENSOR', id:'FR-02', color:'#94a3b8', mesh:'CapTouch_Pad_1', prio:'P0',
            desc:'On-body detection and gesture recognition within 500ms response. Dual pads on skin side for contact sensing. Optional GSR (Galvanic Skin Response) measurement via shared IBC electrodes for stress/arousal detection.',
            blocks:[
                {t:'Sensing',rows:[['Type','Capacitive (proximity + touch)'],['Response','<500 ms detection'],['Pads','2 differential touch zones']]},
                {t:'Interface',rows:[['Bus','I2C or nRF5340 COMP/LPCOMP'],['Mode','On-body / off-body detection'],['Optional','GSR via IBC electrodes']]},
                {t:'Software',rows:[['Thread','Sensor Sampling (priority 2)'],['Events','Touch, release, hold, swipe']]}
            ],
            chips:['AT42QT','nRF5340 COMP','nRF5340 LPCOMP'],
            uses:['On-body detection','Gesture input','Skin conductance (GSR)','Sleep/wake trigger']
        },
        haptic: {
            name:'Haptic Motor', cat:'FEEDBACK', id:'FR-08', color:'#8b5cf6', mesh:'Haptic_LRA_Motor', prio:'P1',
            desc:'LRA vibration motor with DRV2605L haptic driver IC. Configurable vibration patterns for alerts, navigation cues, and IBC signaling confirmation. Software-defined waveforms via I2C register programming.',
            blocks:[
                {t:'Motor',rows:[['Type','ERM or LRA (Linear Resonant)'],['Driver IC','DRV2605L'],['Patterns','Software configurable']]},
                {t:'Interface',rows:[['Bus','I2C to DRV2605L'],['GPIO','Enable + trigger pin'],['Thread','LED/Haptic (priority 5)']]},
                {t:'Use Cases',rows:[['Alerts','BLE disconnect, low battery'],['IBC','TX/RX confirmation buzz'],['Navigation','Directional haptic cues']]}
            ],
            chips:['DRV2605L','LRA','ERM'],
            uses:['Alert notifications','IBC confirmation','Navigation cues','Timer/alarm feedback']
        },
        ble: {
            name:'BLE 5.3 Radio', cat:'WIRELESS', id:'FR-04', color:'#06b6d4', mesh:'BLE_53_Antenna', prio:'P0',
            desc:'Integrated BLE 5.3 on net core (64 MHz). GATT server exposes all sensor characteristics. OTA DFU via SMP/mcumgr. LESC secure pairing with bonding. Configurable advertising intervals and directed reconnection.',
            blocks:[
                {t:'Radio',rows:[['Version','BLE 5.3 (integrated)'],['Range','\u226510m open space'],['Latency','<100ms notification'],['Core','Net core (64 MHz)']]},
                {t:'Profiles',rows:[['Server','GATT with sensor characteristics'],['Optional','HID over GATT'],['Advertising','Configurable intervals'],['Reconnect','Directed advertising']]},
                {t:'Security',rows:[['Pairing','LESC (LE Secure Connections)'],['OTA DFU','SMP / mcumgr (nRF Connect)'],['Bonding','Persistent key storage']]}
            ],
            chips:['BLE 5.3','GATT','LESC','SMP','mcumgr'],
            uses:['Sensor data streaming','OTA firmware updates','Secure pairing','Mobile app connection']
        },
        nfc: {
            name:'NFC-A Tag', cat:'NEAR FIELD', id:'FR-06', color:'#3b82f6', mesh:'NFC_Antenna_Loop', prio:'P1',
            desc:'Passive NFC-A Type 2 Tag (integrated in nRF5340). NDEF records for onboarding URL and custom application credentials. PCB trace antenna loop. Used for tap-to-pair, identity presentation, and asset tracking.',
            blocks:[
                {t:'NFC',rows:[['Type','NFC-A / Type 2 Tag (passive)'],['Mode','Tag emulation (no power needed)'],['Antenna','PCB trace loop or flex antenna']]},
                {t:'NDEF Records',rows:[['URL','Onboarding / provisioning link'],['App Record','Identity credential payload'],['Custom','Device serial, firmware version']]},
                {t:'Use Cases',rows:[['Pairing','Tap-to-pair with phone/reader'],['Identity','Credential presentation'],['Tracking','Asset tracking / check-in']]}
            ],
            chips:['NFC-A','NDEF','Type 2 Tag'],
            uses:['Tap-to-pair device setup','Identity credential','Asset tracking','Onboarding URL']
        },
        ibc: {
            name:'Galvanic IBC', cat:'INTRA-BODY', id:'FR-07', color:'#ec4899', mesh:'IBC_TX_Plus', prio:'P1',
            desc:'Key differentiating feature. Body as conductive medium using differential galvanic coupling at 100kHz-2MHz. Up to 1Mbps data rate. 4 skin-side electrodes (TX+/TX-, RX+/RX-) with analog front-end for signal generation and reception.',
            blocks:[
                {t:'Physical Layer',rows:[['Frequency','100 kHz \u2013 2 MHz'],['Data Rate','Up to 1 Mbps'],['Modulation','ASK / FSK / OOK'],['Electrodes','2-diff (TX+/TX\u2212, RX+/RX\u2212)']]},
                {t:'Analog Front-End',rows:[['TX','nRF5340 PWM/Timer + amp'],['RX','Amplifier + filter \u2192 ADC'],['Isolation','Coupling caps (no DC path)'],['Candidate IC','Si5351 clock gen']]},
                {t:'Protocol',rows:[['Frame','Preamble+DevID+Payload+CRC16'],['Access','CSMA/CA (multi-device)'],['Safety','<1V peak, current limited'],['Thread','IBC RX: priority 0 (highest)']]}
            ],
            chips:['Galvanic Coupling','Si5351','CRC16','CSMA/CA','Op-Amp'],
            uses:['Device-to-device handshake','Body area network','SOS relay','Proximity identity']
        },
        temp: {
            name:'AHT10 Sensor', cat:'ENVIRONMENT', id:'FR-03', color:'#f59e0b', mesh:'AHT10_TempHumid', prio:'P0',
            desc:'Temperature (\u00b10.3\u00b0C accuracy) and humidity (\u00b12% RH) monitoring every 10 seconds via I2C. Skin temperature proxy for health monitoring. Housed near vent holes in case for airflow.',
            blocks:[
                {t:'Specifications',rows:[['Temperature','\u00b10.3\u00b0C accuracy'],['Humidity','\u00b12% RH accuracy'],['Voltage','3.3V'],['Interface','I2C (address 0x38)']]},
                {t:'Software',rows:[['Interval','Every 10 seconds'],['Thread','Sensor Sampling (priority 2)'],['Calibration','Factory calibrated']]},
                {t:'Use Cases',rows:[['Health','Skin temperature proxy'],['Environment','Ambient conditions'],['Comfort','Heat stress detection']]}
            ],
            chips:['AHT10','I2C','3.3V'],
            uses:['Skin temperature monitoring','Humidity tracking','Heat stress alerts','Environmental logging']
        },
        led: {
            name:'WS2812B RGB', cat:'VISUAL OUTPUT', id:'FR-09', color:'#ec4899', mesh:'WS2812B_RGB_LED', prio:'P1',
            desc:'Addressable NeoPixel-compatible RGB LED. 16M color range via single-wire protocol. Status indication for BLE state, charging, alerts, and color-coded sensor states. Driven by Zephyr LED Strip driver or SPI bitbang.',
            blocks:[
                {t:'LED',rows:[['Type','WS2812B (NeoPixel-compatible)'],['Colors','16,777,216 RGB'],['Protocol','Single-wire GPIO (800kHz)'],['Timing','T0H: 400ns, T1H: 800ns']]},
                {t:'Interface',rows:[['Driver','Zephyr LED Strip / SPI bitbang'],['GPIO','Single data pin'],['Thread','LED/Haptic (priority 5)']]},
                {t:'States',rows:[['Blue pulse','BLE advertising'],['Green solid','Connected'],['Red flash','Low battery / error'],['Custom','Color-coded sensor alerts']]}
            ],
            chips:['WS2812B','NeoPixel','800kHz'],
            uses:['BLE connection status','Battery level indication','Sensor alert colors','IBC activity flash']
        },
        usb: {
            name:'USB 2.0 FS', cat:'WIRED I/O', id:'FR-11', color:'#14b8a6', mesh:'USB_C_Port', prio:'P2',
            desc:'Native 12 Mbps USB 2.0 Full Speed on nRF5340. CDC-ACM class for serial debug console, DFU firmware updates, and bus power charging for the LiPo battery.',
            blocks:[
                {t:'USB',rows:[['Speed','12 Mbps (Full Speed)'],['Class','CDC-ACM (virtual serial)'],['DFU','mcumgr + nrfutil'],['Connector','USB-C']]},
                {t:'Power',rows:[['Charging','USB bus power \u2192 LiPo'],['Voltage','5V input, 3.3V regulated'],['Thread','USB CDC Logger (priority 7)']]},
                {t:'Debug',rows:[['Console','printf via CDC-ACM'],['Logging','Sensor dumps, IBC traces'],['Shell','Zephyr shell over USB']]}
            ],
            chips:['USB 2.0 FS','CDC-ACM','USB-C'],
            uses:['Firmware DFU updates','Serial debug console','LiPo charging','Data export']
        },
        battery: {
            name:'200mAh LiPo', cat:'POWER', id:'NFR-01', color:'#ef4444', mesh:'LiPo_200mAh', prio:'P0',
            desc:'200mAh lithium polymer pouch cell. Target >8 hours runtime in normal operation. USB bus power charging. Low-power sleep modes for extended standby. Largest internal component by volume.',
            blocks:[
                {t:'Battery',rows:[['Capacity','200 mAh'],['Chemistry','Lithium Polymer (LiPo)'],['Voltage','3.7V nominal'],['Charging','USB bus power (5V \u2192 4.2V)']]},
                {t:'Power Budget',rows:[['Runtime','>8 hours (normal mode)'],['Sleep','Months in deep sleep'],['Peak Current','~50 mA (BLE TX + IBC)'],['Avg Current','~25 mA (typical use)']]},
                {t:'Safety',rows:[['Protection','Overcharge / overdischarge'],['Connector','JST-PH 2-pin / pogo'],['Monitoring','ADC voltage divider']]}
            ],
            chips:['LiPo','200mAh','3.7V','JST-PH'],
            uses:['8+ hour continuous operation','USB-C charging','Low-power sleep mode','Voltage monitoring']
        },
        button: {
            name:'User Button', cat:'INPUT', id:'FR-10', color:'#d4a017', mesh:'User_Button', prio:'P0',
            desc:'GPIO active-low with internal pull-up and 10ms software debounce. Short press cycles through operating modes, long press (3 seconds) toggles power or initiates factory reset.',
            blocks:[
                {t:'Hardware',rows:[['GPIO','Active-low with internal pull-up'],['Debounce','10ms software debounce'],['Type','Tactile switch, side-mounted']]},
                {t:'Actions',rows:[['Short Press','Mode cycle (sensor/IBC/BLE)'],['Long Press (3s)','Power toggle'],['Very Long (10s)','Factory reset']]},
                {t:'Software',rows:[['Thread','Main loop / interrupt'],['Events','PRESS, RELEASE, HOLD'],['LED Feedback','Mode color on press']]}
            ],
            chips:['GPIO','Tactile Switch'],
            uses:['Mode cycling','Power on/off','Factory reset','IBC manual trigger']
        },
    };

    /* ── Architecture card data (all 12 subsystems) ── */
    const archCards = [
        { icon:'\u2699', bg:'linear-gradient(135deg,#a855f7,#7c3aed)', glow:'#a855f7', h:'nRF5340 SoC', fr:'SoC', p:'Dual-core ARM Cortex-M33. App core 128 MHz + net core 64 MHz.', specs:[['App Core','128 MHz'],['Net Core','64 MHz'],['RTOS','Zephyr'],['Flash','1 MB + 256 KB']], use:'Sensor fusion, IBC, BLE' },
        { icon:'\u27F3', bg:'linear-gradient(135deg,#22c55e,#16a34a)', glow:'#22c55e', h:'6-Axis IMU', fr:'FR-01', p:'Accel + gyro with FIFO and interrupt-driven wakeup.', specs:[['Accel','\u00b12g\u2013\u00b116g'],['Gyro','\u00b1250\u20132000 dps'],['Bus','SPI / I2C'],['Rate','\u226550 Hz']], use:'Motion, gestures, steps' },
        { icon:'\u{1F4F6}', bg:'linear-gradient(135deg,#06b6d4,#0891b2)', glow:'#06b6d4', h:'BLE 5.3', fr:'FR-04', p:'Integrated radio with GATT server and OTA DFU.', specs:[['Range','\u226510m'],['Security','LESC'],['Latency','<100ms'],['OTA','SMP / mcumgr']], use:'Sensor streaming, updates' },
        { icon:'\u26A1', bg:'linear-gradient(135deg,#ec4899,#db2777)', glow:'#ec4899', h:'Galvanic IBC', fr:'FR-07', p:'Body as conductive medium. Key differentiating feature.', specs:[['Freq','100kHz\u20132MHz'],['Rate','\u22641 Mbps'],['Electrodes','2-diff (4 pads)'],['Safety','<1V peak']], use:'Body network, handshake' },
        { icon:'\u{1F4F1}', bg:'linear-gradient(135deg,#3b82f6,#1d4ed8)', glow:'#3b82f6', h:'NFC-A Tag', fr:'FR-06', p:'Passive NFC for tap-to-pair and identity.', specs:[['Type','Type 2 Tag'],['Records','NDEF URL + App'],['Antenna','PCB trace'],['Mode','Passive (no power)']], use:'Pairing, identity, tracking' },
        { icon:'\u{1F321}', bg:'linear-gradient(135deg,#f59e0b,#d97706)', glow:'#f59e0b', h:'AHT10', fr:'FR-03', p:'Temperature \u00b10.3\u00b0C and humidity \u00b12% RH.', specs:[['Temp','\u00b10.3\u00b0C'],['Humidity','\u00b12% RH'],['Bus','I2C (0x38)'],['Interval','10 sec']], use:'Skin temp, environment' },
        { icon:'\u{1F4A5}', bg:'linear-gradient(135deg,#8b5cf6,#6d28d9)', glow:'#8b5cf6', h:'Haptic Motor', fr:'FR-08', p:'LRA motor with DRV2605L for tactile feedback.', specs:[['Type','LRA'],['Driver','DRV2605L'],['Patterns','Software cfg'],['Bus','I2C']], use:'Alerts, IBC confirm, nav' },
        { icon:'\u{1F7E2}', bg:'linear-gradient(135deg,#ef4444,#dc2626)', glow:'#ef4444', h:'WS2812B LED', fr:'FR-09', p:'Addressable RGB for 16M color status indication.', specs:[['Colors','16M RGB'],['Protocol','800kHz 1-wire'],['Driver','PWM / SPI'],['States','BLE/Battery/Alert']], use:'Status, alerts, modes' },
        { icon:'\u{1F50C}', bg:'linear-gradient(135deg,#14b8a6,#0d9488)', glow:'#14b8a6', h:'USB 2.0 FS', fr:'FR-11', p:'DFU, debug console, bus power charging.', specs:[['Speed','12 Mbps'],['Class','CDC-ACM'],['DFU','mcumgr'],['Connector','USB-C']], use:'Debug, DFU, charging' },
        { icon:'\u{1F590}', bg:'linear-gradient(135deg,#94a3b8,#64748b)', glow:'#94a3b8', h:'Capacitive Touch', fr:'FR-02', p:'On-body detection with <500ms response. Dual pads.', specs:[['Type','Capacitive'],['Response','<500ms'],['Pads','2 differential'],['Optional','GSR via IBC']], use:'Body detect, gestures' },
        { icon:'\u{1F50B}', bg:'linear-gradient(135deg,#ef4444,#b91c1c)', glow:'#ef4444', h:'200mAh LiPo', fr:'NFR', p:'Lithium polymer cell with >8h runtime and USB charging.', specs:[['Capacity','200 mAh'],['Runtime','>8 hours'],['Voltage','3.7V nom'],['Charging','USB bus power']], use:'All-day power, sleep' },
        { icon:'\u{1F518}', bg:'linear-gradient(135deg,#d4a017,#b8860b)', glow:'#d4a017', h:'User Button', fr:'FR-10', p:'Tactile switch with short/long press actions.', specs:[['GPIO','Active-low'],['Debounce','10ms'],['Short','Mode cycle'],['Long','Power toggle']], use:'Mode, power, reset' },
    ];

    /* ── Functional Requirements (from PRD Table 3) ── */
    const funcReqs = [
        { id:'FR-01', prio:'P0', desc:'Sample IMU at minimum 50 Hz and detect motion events' },
        { id:'FR-02', prio:'P0', desc:'Detect skin contact via capacitive sensor within 500ms' },
        { id:'FR-03', prio:'P0', desc:'Read AHT10 temperature and humidity every 10 seconds' },
        { id:'FR-04', prio:'P0', desc:'Advertise BLE and maintain connection to a central device' },
        { id:'FR-05', prio:'P0', desc:'Support OTA firmware update over BLE (SMP/mcumgr)' },
        { id:'FR-06', prio:'P1', desc:'Present an NFC NDEF tag when polled by an NFC reader' },
        { id:'FR-07', prio:'P1', desc:'Transmit and receive IBC frames in the 100 kHz\u20132 MHz band' },
        { id:'FR-08', prio:'P1', desc:'Produce configurable haptic patterns via vibration motor' },
        { id:'FR-09', prio:'P1', desc:'Indicate status via WS2812B RGB LED' },
        { id:'FR-10', prio:'P0', desc:'Respond to button press events (short / long)' },
        { id:'FR-11', prio:'P2', desc:'Log data over USB CDC for debugging' },
    ];

    /* ── Non-Functional Requirements ── */
    const nfrData = [
        { val:'>8h', label:'Battery Life', detail:'200 mAh LiPo, normal mode', color:'var(--red)' },
        { val:'<100ms', label:'BLE Latency', detail:'Sensor event to notification', color:'var(--cyan)' },
        { val:'\u226510m', label:'BLE Range', detail:'Open space minimum', color:'var(--blue)' },
        { val:'1 Mbps', label:'IBC Data Rate', detail:'Wrist-to-wrist, wrist-to-ankle', color:'var(--pink)' },
        { val:'0', label:'Build Warnings', detail:'Platform.IO CI clean builds', color:'var(--green)' },
        { val:'100%', label:'Static Analysis', detail:'cppcheck + clang-tidy in CI', color:'var(--purple)' },
    ];

    /* ── Milestones (from PRD Table 4) ── */
    const milestones = [
        { id:'M1', name:'Toolchain', full:'Platform.IO + Zephyr builds and flashes to nRF5340-DK', time:'Wk 1' },
        { id:'M2', name:'Sensors', full:'IMU, AHT10, cap touch via I2C/SPI; USB CDC logging', time:'Wk 2\u20133' },
        { id:'M3', name:'BLE Stack', full:'GATT server advertising sensor data; mobile app confirmed', time:'Wk 3\u20134' },
        { id:'M4', name:'Peripherals', full:'WS2812B LED, haptic motor, NFC tag, button handling', time:'Wk 4\u20135' },
        { id:'M5', name:'IBC TX/RX', full:'IBC demonstrated on dev board with analog breadboard circuit', time:'Wk 5\u20137' },
        { id:'M6', name:'Integration', full:'All subsystems integrated; power profiling; OTA DFU validated', time:'Wk 7\u20138' },
        { id:'M7', name:'Custom PCB', full:'Schematic + layout review; gerbers sent to fab house', time:'Wk 9\u201310' },
    ];

    /* ── Open Questions (from PRD Section 10) ── */
    const risks = [
        { tag:'ANALOG', q:'IBC Analog Front-End', detail:'Which discrete IC or MCU peripheral generates/detects signals in 100 kHz\u20132 MHz? Candidates: Si5351 clock gen, nRF5340 PWM + external op-amp.' },
        { tag:'SENSING', q:'Capacitive Touch IC', detail:'Will the nRF5340 COMP/LPCOMP peripheral suffice for touch sensing, or is a dedicated IC (e.g., AT42QT) needed?' },
        { tag:'COEXISTENCE', q:'IBC + BLE/NFC Interference', detail:'How will IBC galvanic coupling coexist with BLE radio and NFC without RF interference or signal degradation?' },
        { tag:'MECHANICAL', q:'Battery Connector Type', detail:'JST-PH 2-pin vs pogo pins for wearable form factor? Pogo allows easier case assembly, JST is more reliable.' },
        { tag:'DUAL-USE', q:'IBC Electrodes as GSR Sensor', detail:'Can the 4 IBC skin electrodes double as Galvanic Skin Response (GSR) / skin conductance sensors for stress detection?' },
    ];

    /* ── Ticker data ── */
    const tickerItems = [
        ['SoC','nRF5340 Dual-Core'], ['RTOS','Zephyr 3.x'], ['BLE','5.3 + LESC'],
        ['IBC','Galvanic 1 Mbps'], ['IMU','6-Axis \u226550 Hz'], ['NFC','Type 2 Tag'],
        ['Battery','200 mAh / 8+ hr'], ['USB','12 Mbps CDC-ACM'],
        ['Touch','Capacitive <500ms'], ['Haptic','DRV2605L LRA'],
        ['LED','WS2812B 16M RGB'], ['Temp','\u00b10.3\u00b0C AHT10'],
        ['Build','Platform.IO CI'], ['Debug','J-Link / OpenOCD'],
    ];

    /* ── Build Ticker ── */
    const ticker = document.getElementById('ticker');
    const tickerHTML = tickerItems.map(([k,v]) =>
        `<span class="ticker-item"><span class="ticker-val">${k}</span>${v}<span class="ticker-sep">\u00b7</span></span>`
    ).join('');
    ticker.innerHTML = tickerHTML + tickerHTML; // duplicate for infinite scroll

    /* ── Password ── */
    const PW = 'flowbond';
    function auth() {
        const v = document.getElementById('pw').value.toLowerCase();
        if (v === PW) {
            document.getElementById('gate').classList.add('gone');
            document.getElementById('app').classList.add('on');
            localStorage.setItem('fb-auth','1');
            boot();
        } else {
            document.getElementById('pw-err').classList.add('on');
            document.getElementById('pw').value = '';
            setTimeout(() => document.getElementById('pw-err').classList.remove('on'), 1800);
        }
    }
    document.getElementById('pw').addEventListener('keydown', e => { if (e.key==='Enter') auth(); });
    document.getElementById('pw-btn').addEventListener('click', auth);
    document.getElementById('pw').focus();
    if (localStorage.getItem('fb-auth')==='1') {
        document.getElementById('gate').classList.add('gone');
        document.getElementById('app').classList.add('on');
        requestAnimationFrame(boot);
    }

    /* ── Build Dock ── */
    const dock = document.getElementById('dock');
    for (const [k,v] of Object.entries(C)) {
        const b = document.createElement('button');
        b.className = 'dock-btn';
        b.dataset.c = k;
        b.innerHTML = `<span class="dock-dot" style="background:${v.color}"></span>${v.name}`;
        dock.appendChild(b);
    }

    /* ── Build NFR Grid ── */
    const ng = document.getElementById('nfr-grid');
    nfrData.forEach((n, i) => {
        const d = document.createElement('div');
        d.className = `nfr-card reveal reveal-d${i % 6}`;
        d.innerHTML = `<div class="nfr-val" style="color:${n.color}">${n.val}</div><div class="nfr-label">${n.label}</div><div class="nfr-detail">${n.detail}</div>`;
        ng.appendChild(d);
    });

    /* ── Build Arch Grid ── */
    const ag = document.getElementById('arch-grid');
    archCards.forEach((c, i) => {
        const d = document.createElement('div');
        d.className = `acard reveal reveal-d${i % 6}`;
        d.innerHTML = `<div class="acard-glow" style="background:radial-gradient(circle,${c.glow},transparent)"></div><span class="acard-fr">${c.fr}</span><div class="acard-icon" style="background:${c.bg}">${c.icon}</div><h3>${c.h}</h3><p>${c.p}</p><div class="acard-specs">${c.specs.map(s=>`<div class="acard-spec"><span>${s[0]}</span><span>${s[1]}</span></div>`).join('')}</div><div class="acard-use">\u2192 ${c.use}</div>`;
        ag.appendChild(d);
    });

    /* ── Build FR Grid ── */
    const fg = document.getElementById('fr-grid');
    funcReqs.forEach((r, i) => {
        const d = document.createElement('div');
        d.className = `fr-item reveal reveal-d${i % 6}`;
        const pc = r.prio.toLowerCase();
        d.innerHTML = `<span class="fr-badge ${pc}">${r.prio}</span><div><div class="fr-id">${r.id}</div><div class="fr-desc">${r.desc}</div></div>`;
        fg.appendChild(d);
    });

    /* ── Build Risk Grid ── */
    const rg = document.getElementById('risk-grid');
    risks.forEach((r, i) => {
        const d = document.createElement('div');
        d.className = `risk-item reveal reveal-d${i % 6}`;
        d.innerHTML = `<div class="risk-tag">${r.tag}</div><div class="risk-q">${r.q}</div><div class="risk-detail">${r.detail}</div>`;
        rg.appendChild(d);
    });

    /* ── Build Milestones ── */
    const mg = document.getElementById('miles-grid');
    milestones.forEach((m, i) => {
        const d = document.createElement('div');
        d.className = `mile reveal reveal-d${i % 6}`;
        d.innerHTML = `<div class="mile-id">${m.id}</div><div class="mile-dot"></div><div class="mile-desc">${m.name}</div><div class="mile-full">${m.full}</div><div class="mile-time">${m.time}</div>`;
        mg.appendChild(d);
    });

    /* ── Panel Logic ── */
    let activeComp = null;
    const panel = document.getElementById('panel');

    function openPanel(key) {
        const c = C[key]; if (!c) return;
        activeComp = key;
        document.getElementById('p-cat').textContent = c.cat;
        document.getElementById('p-title').textContent = c.name;
        document.getElementById('p-id').textContent = c.id;

        let h = `<p class="panel-desc">${c.desc}</p>`;
        if (c.prio) { const pc = c.prio.toLowerCase(); h += `<div class="prio prio-${pc}">${c.prio}</div>`; }
        c.blocks.forEach(b => {
            h += `<div class="sblock"><div class="sblock-title">${b.t}</div>`;
            b.rows.forEach(r => h += `<div class="srow"><span class="srow-k">${r[0]}</span><span class="srow-v">${r[1]}</span></div>`);
            h += '</div>';
        });
        if (c.uses?.length) {
            h += '<div class="sblock"><div class="sblock-title">Use Cases</div><div class="panel-uses">';
            c.uses.forEach(u => h += `<div class="panel-use">${u}</div>`);
            h += '</div></div>';
        }
        if (c.chips?.length) {
            h += '<div class="sblock"><div class="sblock-title">Parts / Keywords</div><div class="chips">';
            c.chips.forEach(ch => h += `<span class="chip">${ch}</span>`);
            h += '</div></div>';
        }
        document.getElementById('p-body').innerHTML = h;
        panel.classList.add('open');

        dock.querySelectorAll('.dock-btn').forEach(b => b.classList.toggle('on', b.dataset.c === key));
        highlightMesh(c.mesh);
    }

    function closePanel() {
        activeComp = null;
        panel.classList.remove('open');
        dock.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('on'));
        resetHighlight();
    }

    document.getElementById('panel-x').addEventListener('click', closePanel);
    document.addEventListener('keydown', e => { if (e.key==='Escape') closePanel(); });
    dock.addEventListener('click', e => {
        const btn = e.target.closest('.dock-btn');
        if (!btn) return;
        const k = btn.dataset.c;
        activeComp === k ? closePanel() : openPanel(k);
    });

    /* ── Three.js ── */
    let scene, camera, renderer, controls, modelGroup;
    let meshMap = {};

    function boot() {
        const canvas = document.getElementById('viewer');
        const hero = canvas.parentElement;

        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050507);

        camera = new THREE.PerspectiveCamera(40, hero.clientWidth / hero.clientHeight, 0.001, 50);
        camera.position.set(0.05, 0.04, 0.08);

        renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
        renderer.setSize(hero.clientWidth, hero.clientHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.3;

        controls = new OrbitControls(camera, canvas);
        controls.enableDamping = true;
        controls.dampingFactor = 0.06;
        controls.minDistance = 0.03;
        controls.maxDistance = 0.25;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 1.2;
        controls.target.set(0, 0, 0);

        // Lights
        scene.add(new THREE.AmbientLight(0x404060, 0.5));

        const key = new THREE.DirectionalLight(0xffffff, 2);
        key.position.set(0.08, 0.1, 0.06);
        scene.add(key);

        const fill = new THREE.DirectionalLight(0xec4899, 0.5);
        fill.position.set(-0.06, 0.04, -0.04);
        scene.add(fill);

        const rim = new THREE.PointLight(0x06b6d4, 0.6, 0.3);
        rim.position.set(-0.03, -0.02, 0.06);
        scene.add(rim);

        const under = new THREE.PointLight(0xa855f7, 0.3, 0.2);
        under.position.set(0, -0.05, 0);
        scene.add(under);

        // Grid
        const grid = new THREE.GridHelper(0.3, 30, 0x1a1a28, 0x0d0d14);
        grid.position.y = -0.03;
        scene.add(grid);

        // Load model
        new GLTFLoader().load('flowbond-wearable-final.glb',
            gltf => {
                modelGroup = gltf.scene;
                const box = new THREE.Box3().setFromObject(modelGroup);
                const center = box.getCenter(new THREE.Vector3());
                modelGroup.position.sub(center);
                scene.add(modelGroup);

                modelGroup.traverse(child => {
                    if (child.isMesh) {
                        meshMap[child.name] = child;
                        child.userData.originalMaterial = child.material;
                    }
                });

                const caseMesh = meshMap['DANZ_Case'];
                if (caseMesh) {
                    const mat = caseMesh.material.clone();
                    mat.transparent = true;
                    mat.opacity = 0.25;
                    mat.depthWrite = false;
                    mat.side = THREE.DoubleSide;
                    caseMesh.material = mat;
                    caseMesh.userData.originalMaterial = mat;
                    caseMesh.renderOrder = 999;
                }

                document.getElementById('loader').classList.add('gone');
            },
            p => {
                if (p.total > 0) {
                    const pct = Math.round((p.loaded / p.total) * 100);
                    document.querySelector('.loader-text').textContent = `Loading... ${pct}%`;
                }
            },
            err => {
                console.error(err);
                document.querySelector('.loader-text').textContent = 'Load error';
            }
        );

        // Raycaster
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        canvas.addEventListener('click', e => {
            if (!modelGroup) return;
            const rect = canvas.getBoundingClientRect();
            mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const hits = raycaster.intersectObjects(modelGroup.children, true);
            if (hits.length) {
                const name = hits[0].object.name;
                for (const [k, v] of Object.entries(C)) {
                    if (v.mesh === name || name.startsWith(v.mesh?.split('_')[0])) {
                        openPanel(k);
                        return;
                    }
                }
            }
        });

        window.addEventListener('resize', () => {
            camera.aspect = hero.clientWidth / hero.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(hero.clientWidth, hero.clientHeight);
        });

        animate();
    }

    function highlightMesh(meshName) {
        if (!modelGroup) return;
        modelGroup.traverse(child => {
            if (!child.isMesh) return;
            if (child.name === 'DANZ_Case') return;
            if (child.name === meshName || child.name.startsWith(meshName?.split('_')[0] || '___')) {
                const mat = child.userData.originalMaterial?.clone() || child.material.clone();
                mat.emissive = new THREE.Color(0xffffff);
                mat.emissiveIntensity = 0.4;
                child.material = mat;
            } else {
                const mat = child.userData.originalMaterial?.clone() || child.material.clone();
                mat.transparent = true;
                mat.opacity = 0.15;
                child.material = mat;
            }
        });
    }

    function resetHighlight() {
        if (!modelGroup) return;
        modelGroup.traverse(child => {
            if (child.isMesh && child.userData.originalMaterial) {
                child.material = child.userData.originalMaterial;
            }
        });
    }

    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
    }

    /* ── Scroll Reveal ── */
    const obs = new IntersectionObserver(entries => {
        entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('vis'); });
    }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });
    document.querySelectorAll('.reveal').forEach(el => obs.observe(el));
    </script>
</body>
</html>
