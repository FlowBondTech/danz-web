<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DANZ Wearable Bracelet — Interactive 3D Explorer</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink: #ec4899;
            --pink-dark: #db2777;
            --pink-glow: rgba(236, 72, 153, 0.4);
            --purple: #a855f7;
            --purple-dark: #7c3aed;
            --cyan: #06b6d4;
            --green: #22c55e;
            --amber: #f59e0b;
            --red: #ef4444;
            --blue: #3b82f6;
            --gold: #d4a017;
            --dark: #030305;
            --dark-2: #08080e;
            --dark-3: #0e0e16;
            --surface: #13131d;
            --surface-2: #1a1a28;
            --surface-3: #222234;
            --text: #f0f0f5;
            --text-dim: #5e5e74;
            --text-mid: #8e8ea6;
            --mono: 'JetBrains Mono', monospace;
            --sans: 'Outfit', sans-serif;
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--sans);
            background: var(--dark);
            color: var(--text);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* ── Password Gate ── */
        #gate {
            position: fixed; inset: 0; background: var(--dark);
            display: flex; align-items: center; justify-content: center;
            z-index: 9999; transition: opacity .6s var(--ease-out), visibility .6s;
        }
        #gate.gone { opacity: 0; visibility: hidden; pointer-events: none; }
        .gate-box {
            text-align: center; padding: 48px; width: 90%; max-width: 380px;
            background: var(--surface); border-radius: 28px;
            border: 1px solid rgba(236,72,153,.15);
            box-shadow: 0 40px 80px rgba(0,0,0,.5), 0 0 120px rgba(236,72,153,.05);
        }
        .gate-logo {
            font-size: 36px; font-weight: 900; letter-spacing: -1px;
            background: linear-gradient(135deg, var(--pink), var(--purple));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .gate-tag {
            font-family: var(--mono); font-size: 9px; letter-spacing: 4px;
            text-transform: uppercase; color: var(--cyan); margin: 4px 0 32px;
        }
        .gate-input {
            width: 100%; padding: 14px 18px; border: 1.5px solid rgba(236,72,153,.2);
            border-radius: 14px; background: var(--dark-2); color: var(--text);
            font-size: 15px; text-align: center; letter-spacing: 3px;
            font-family: var(--sans); transition: border-color .3s, box-shadow .3s;
        }
        .gate-input:focus {
            outline: none; border-color: var(--pink);
            box-shadow: 0 0 0 4px rgba(236,72,153,.1);
        }
        .gate-input::placeholder { letter-spacing: 0; color: var(--text-dim); font-size: 13px; }
        .gate-btn {
            width: 100%; padding: 14px; margin-top: 14px; border: none; border-radius: 14px;
            background: linear-gradient(135deg, var(--pink), var(--purple));
            color: #fff; font-size: 14px; font-weight: 600; cursor: pointer;
            transition: transform .2s var(--ease-spring), box-shadow .3s;
        }
        .gate-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 30px var(--pink-glow); }
        .gate-err { color: var(--red); font-size: 12px; margin-top: 10px; opacity: 0; transition: opacity .3s; }
        .gate-err.on { opacity: 1; }

        /* ── App Container ── */
        #app { display: none; }
        #app.on { display: block; }

        /* ── Top Bar ── */
        .topbar {
            position: fixed; top: 0; left: 0; right: 0; z-index: 200;
            padding: 14px 28px; display: flex; justify-content: space-between; align-items: center;
            background: linear-gradient(180deg, rgba(3,3,5,.96) 0%, rgba(3,3,5,.7) 60%, transparent 100%);
            backdrop-filter: blur(16px);
        }
        .topbar-left { display: flex; align-items: center; gap: 14px; }
        .topbar-brand {
            font-size: 20px; font-weight: 900; letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--pink), var(--purple));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .topbar-sep { width: 1px; height: 16px; background: rgba(255,255,255,.08); }
        .topbar-label {
            font-family: var(--mono); font-size: 9px; color: var(--text-dim);
            letter-spacing: 3px; text-transform: uppercase;
        }
        .topbar-right { display: flex; align-items: center; gap: 10px; }
        .topbar-chip {
            font-family: var(--mono); font-size: 10px; padding: 5px 12px;
            border-radius: 20px; border: 1px solid rgba(6,182,212,.2);
            color: var(--cyan); background: rgba(6,182,212,.04);
        }

        /* ── 3D Viewport ── */
        .viewport { position: relative; height: 100vh; overflow: hidden; }
        #viewer { width: 100%; height: 100%; cursor: grab; }
        #viewer:active { cursor: grabbing; }

        .loader {
            position: absolute; inset: 0; background: var(--dark);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 50; transition: opacity 1s var(--ease-out);
        }
        .loader.gone { opacity: 0; pointer-events: none; }
        .loader-ring {
            width: 56px; height: 56px; border-radius: 50%;
            border: 2px solid rgba(236,72,153,.1);
            border-top-color: var(--pink);
            border-right-color: var(--purple);
            animation: spin .9s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader-pct {
            margin-top: 20px; font-family: var(--mono); font-size: 24px;
            font-weight: 300; color: var(--pink); letter-spacing: 2px;
        }
        .loader-label {
            margin-top: 4px; font-family: var(--mono); font-size: 9px;
            color: var(--text-dim); letter-spacing: 4px; text-transform: uppercase;
        }

        /* ── Hero Overlay ── */
        .hero-overlay {
            position: absolute; top: 90px; left: 36px; z-index: 10;
            max-width: 380px; pointer-events: none;
        }
        .hero-badge {
            display: inline-flex; align-items: center; gap: 6px;
            font-family: var(--mono); font-size: 9px; letter-spacing: 3px;
            text-transform: uppercase; color: var(--cyan); margin-bottom: 14px;
            padding: 4px 12px; border-radius: 20px;
            background: rgba(6,182,212,.06); border: 1px solid rgba(6,182,212,.15);
        }
        .hero-badge-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--cyan); animation: pulse-dot 2s ease infinite; }
        @keyframes pulse-dot { 0%, 100% { opacity: 1; } 50% { opacity: .3; } }
        .hero-title {
            font-size: 48px; font-weight: 900; line-height: 1.02;
            letter-spacing: -1px; margin-bottom: 16px;
        }
        .hero-title em {
            font-style: normal;
            background: linear-gradient(135deg, var(--pink), var(--purple), var(--cyan));
            background-size: 200% 200%;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: gradient-shift 4s ease infinite;
        }
        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .hero-desc { font-size: 14px; color: var(--text-dim); line-height: 1.75; margin-bottom: 24px; }
        .hero-metrics { display: flex; gap: 28px; }
        .metric-val {
            font-family: var(--mono); font-size: 22px; font-weight: 700;
            background: linear-gradient(135deg, var(--pink), var(--purple));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .metric-label { font-size: 10px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1.5px; margin-top: 2px; }

        /* ── Mode Controls (bottom-right) ── */
        .modes {
            position: fixed; bottom: 90px; right: 24px; z-index: 100;
            display: flex; flex-direction: column; gap: 6px;
        }
        .mode-btn {
            width: 44px; height: 44px; border-radius: 14px;
            background: rgba(10,10,16,.88); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,.06); color: var(--text-dim);
            font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all .25s var(--ease-out); position: relative;
        }
        .mode-btn:hover { border-color: rgba(236,72,153,.3); color: var(--text); background: rgba(236,72,153,.08); }
        .mode-btn.on { border-color: var(--pink); color: var(--pink); background: rgba(236,72,153,.1); box-shadow: 0 0 20px rgba(236,72,153,.15); }
        .mode-tip {
            position: absolute; right: 54px; top: 50%; transform: translateY(-50%);
            font-family: var(--mono); font-size: 9px; letter-spacing: 1px;
            white-space: nowrap; color: var(--text-dim); opacity: 0;
            transition: opacity .2s; pointer-events: none;
            background: rgba(10,10,16,.95); padding: 4px 10px; border-radius: 6px;
        }
        .mode-btn:hover .mode-tip { opacity: 1; }

        /* ── Component Dock (bottom) ── */
        .dock {
            position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 3px; padding: 5px;
            background: rgba(8,8,14,.92); backdrop-filter: blur(24px);
            border-radius: 16px; border: 1px solid rgba(236,72,153,.08);
            z-index: 100; overflow-x: auto; max-width: 92vw;
        }
        .dock::-webkit-scrollbar { height: 0; }
        .dock-btn {
            padding: 7px 12px; border-radius: 10px; border: 1px solid transparent;
            background: transparent; color: var(--text-dim); cursor: pointer;
            font-family: var(--mono); font-size: 9px; letter-spacing: .3px;
            white-space: nowrap; transition: all .2s var(--ease-out);
            display: flex; align-items: center; gap: 5px;
        }
        .dock-btn:hover { color: var(--text); background: rgba(255,255,255,.03); }
        .dock-btn.on { color: #fff; background: rgba(236,72,153,.15); border-color: rgba(236,72,153,.3); }
        .dock-dot { width: 5px; height: 5px; border-radius: 50%; flex-shrink: 0; }

        /* ── Side Panel ── */
        .panel {
            position: fixed; right: 0; top: 0; bottom: 0; width: 380px; max-width: 90vw;
            background: rgba(8,8,14,.97); backdrop-filter: blur(30px);
            border-left: 1px solid rgba(236,72,153,.08);
            z-index: 300; transform: translateX(100%);
            transition: transform .4s var(--ease-out);
            overflow-y: auto; overflow-x: hidden;
        }
        .panel.open { transform: translateX(0); }
        .panel::-webkit-scrollbar { width: 2px; }
        .panel::-webkit-scrollbar-thumb { background: rgba(236,72,153,.2); border-radius: 2px; }

        .panel-head {
            position: sticky; top: 0; z-index: 5; padding: 24px 24px 18px;
            background: rgba(8,8,14,.98); border-bottom: 1px solid rgba(255,255,255,.03);
        }
        .panel-x {
            position: absolute; top: 18px; right: 18px;
            width: 30px; height: 30px; border-radius: 8px;
            background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.06);
            color: var(--text-dim); font-size: 15px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all .2s;
        }
        .panel-x:hover { background: rgba(239,68,68,.12); border-color: var(--red); color: var(--red); }
        .panel-cat {
            font-family: var(--mono); font-size: 9px; letter-spacing: 3px;
            text-transform: uppercase; color: var(--cyan); margin-bottom: 4px;
        }
        .panel-title { font-size: 22px; font-weight: 700; letter-spacing: -0.3px; }
        .panel-id { font-family: var(--mono); font-size: 10px; color: var(--text-dim); margin-top: 3px; }

        .panel-body { padding: 18px 24px 36px; }
        .panel-desc { font-size: 13px; color: var(--text-dim); line-height: 1.8; margin-bottom: 18px; }

        .prio {
            display: inline-block; font-family: var(--mono); font-size: 9px;
            padding: 3px 10px; border-radius: 4px; font-weight: 600; margin-bottom: 14px;
        }
        .prio-p0 { background: rgba(239,68,68,.1); color: var(--red); border: 1px solid rgba(239,68,68,.2); }
        .prio-p1 { background: rgba(245,158,11,.1); color: var(--amber); border: 1px solid rgba(245,158,11,.2); }
        .prio-p2 { background: rgba(6,182,212,.1); color: var(--cyan); border: 1px solid rgba(6,182,212,.2); }

        .sblock { margin-bottom: 20px; }
        .sblock-title {
            font-family: var(--mono); font-size: 9px; letter-spacing: 2px;
            text-transform: uppercase; color: var(--purple); margin-bottom: 10px;
            padding-bottom: 5px; border-bottom: 1px solid rgba(168,85,247,.1);
        }
        .srow { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,.02); }
        .srow-k { font-size: 12px; color: var(--text-dim); }
        .srow-v { font-family: var(--mono); font-size: 12px; color: var(--text); font-weight: 500; }

        .chips { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 6px; }
        .chip {
            font-family: var(--mono); font-size: 9px; padding: 3px 9px; border-radius: 4px;
            background: rgba(168,85,247,.06); border: 1px solid rgba(168,85,247,.15); color: var(--purple);
        }

        /* ── Color Picker ── */
        .color-picker {
            position: fixed; bottom: 90px; left: 24px; z-index: 100;
            display: flex; flex-direction: column; gap: 4px;
            opacity: 0; pointer-events: none;
            transition: opacity .3s var(--ease-out);
        }
        .color-picker.on { opacity: 1; pointer-events: auto; }
        .color-swatch {
            width: 28px; height: 28px; border-radius: 50%; cursor: pointer;
            border: 2px solid transparent; transition: all .2s var(--ease-spring);
            box-shadow: 0 2px 8px rgba(0,0,0,.3);
        }
        .color-swatch:hover { transform: scale(1.2); }
        .color-swatch.on { border-color: #fff; transform: scale(1.15); box-shadow: 0 0 16px var(--pink-glow); }
        .color-label {
            font-family: var(--mono); font-size: 8px; color: var(--text-dim);
            letter-spacing: 2px; text-transform: uppercase; writing-mode: vertical-lr;
            transform: rotate(180deg); margin-bottom: 4px;
        }

        /* ── Fun Toast ── */
        .toast {
            position: fixed; top: 80px; left: 50%; transform: translateX(-50%) translateY(-20px);
            font-family: var(--mono); font-size: 11px; padding: 8px 20px;
            border-radius: 10px; background: rgba(236,72,153,.15);
            border: 1px solid rgba(236,72,153,.3); color: var(--pink);
            backdrop-filter: blur(20px); z-index: 500;
            opacity: 0; pointer-events: none;
            transition: opacity .3s, transform .3s var(--ease-spring);
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* ── Scroll Sections ── */
        .sections { position: relative; z-index: 1; }
        .sec { padding: 100px 40px; max-width: 1060px; margin: 0 auto; }
        .sec-head { text-align: center; margin-bottom: 48px; }
        .sec-head h2 { font-size: 36px; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 10px; }
        .sec-head h2 em {
            font-style: normal;
            background: linear-gradient(135deg, var(--pink), var(--purple));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .sec-head p { font-size: 14px; color: var(--text-dim); max-width: 480px; margin: 0 auto; line-height: 1.7; }

        /* ── Spec Cards ── */
        .spec-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; }
        .spec-card {
            background: var(--surface); border-radius: 16px; padding: 22px;
            border: 1px solid rgba(255,255,255,.03);
            transition: all .35s var(--ease-out); position: relative; overflow: hidden;
        }
        .spec-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--pink), transparent);
            opacity: 0; transition: opacity .35s;
        }
        .spec-card:hover { transform: translateY(-3px); border-color: rgba(236,72,153,.15); }
        .spec-card:hover::before { opacity: 1; }
        .spec-icon {
            width: 36px; height: 36px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; margin-bottom: 12px;
        }
        .spec-card h3 { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
        .spec-card p { font-size: 11px; color: var(--text-dim); line-height: 1.5; }
        .spec-val {
            font-family: var(--mono); font-size: 20px; font-weight: 700;
            margin-top: 10px; display: block;
        }

        /* ── Physical Specs ── */
        .phys-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 32px; }
        .phys-card {
            background: var(--surface); border-radius: 20px; padding: 28px;
            border: 1px solid rgba(255,255,255,.03);
        }
        .phys-card h3 {
            font-size: 16px; font-weight: 700; margin-bottom: 16px;
            display: flex; align-items: center; gap: 8px;
        }
        .phys-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,.025); }
        .phys-row:last-child { border-bottom: none; }
        .phys-k { font-size: 12px; color: var(--text-dim); }
        .phys-v { font-family: var(--mono); font-size: 12px; font-weight: 500; }

        /* ── Fun Fact Banner ── */
        .fun-banner {
            background: linear-gradient(135deg, rgba(236,72,153,.06), rgba(168,85,247,.06));
            border: 1px solid rgba(236,72,153,.12); border-radius: 20px;
            padding: 32px; text-align: center; margin: 60px 0;
            position: relative; overflow: hidden;
        }
        .fun-banner::before {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(circle at 30% 50%, rgba(236,72,153,.08), transparent 60%),
                        radial-gradient(circle at 70% 50%, rgba(168,85,247,.08), transparent 60%);
        }
        .fun-emoji { font-size: 42px; margin-bottom: 12px; position: relative; }
        .fun-banner h3 { font-size: 22px; font-weight: 700; margin-bottom: 8px; position: relative; }
        .fun-banner p { font-size: 13px; color: var(--text-mid); line-height: 1.7; max-width: 500px; margin: 0 auto; position: relative; }

        /* ── Footer ── */
        .foot {
            padding: 40px; text-align: center;
            border-top: 1px solid rgba(236,72,153,.06);
        }
        .foot-logo {
            font-size: 24px; font-weight: 900;
            background: linear-gradient(135deg, var(--pink), var(--purple));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 6px;
        }
        .foot p { color: var(--text-dim); font-size: 12px; }
        .foot-tech { font-family: var(--mono); font-size: 9px; color: rgba(255,255,255,.08); margin-top: 4px; letter-spacing: 2px; }

        /* ── Reveal ── */
        .reveal { opacity: 0; transform: translateY(14px); transition: opacity .6s var(--ease-out), transform .6s var(--ease-out); }
        .reveal.vis { opacity: 1; transform: none; }

        /* ── Responsive ── */
        @media (max-width: 1024px) {
            .spec-grid { grid-template-columns: repeat(2, 1fr); }
            .hero-overlay { max-width: 300px; }
            .hero-title { font-size: 36px; }
        }
        @media (max-width: 768px) {
            .topbar { padding: 10px 16px; }
            .hero-overlay { top: 72px; left: 18px; max-width: 240px; }
            .hero-title { font-size: 26px; }
            .hero-desc { font-size: 12px; }
            .hero-metrics { gap: 14px; }
            .metric-val { font-size: 18px; }
            .spec-grid { grid-template-columns: 1fr; }
            .phys-grid { grid-template-columns: 1fr; }
            .sec { padding: 60px 18px; }
            .sec-head h2 { font-size: 26px; }
            .modes { bottom: 80px; right: 12px; }
            .dock-btn { padding: 5px 9px; font-size: 8px; }
            .color-picker { bottom: 80px; left: 12px; }
        }
    </style>
</head>
<body>
    <!-- Password Gate -->
    <div id="gate">
        <div class="gate-box">
            <div class="gate-logo">DANZ</div>
            <div class="gate-tag">Wearable Bracelet</div>
            <input type="password" id="pw" class="gate-input" placeholder="Access Code" autocomplete="off">
            <button class="gate-btn" id="pw-btn">Enter</button>
            <p class="gate-err" id="pw-err">Incorrect code</p>
        </div>
    </div>

    <div id="app">
        <!-- Top Bar -->
        <nav class="topbar">
            <div class="topbar-left">
                <span class="topbar-brand">DANZ</span>
                <span class="topbar-sep"></span>
                <span class="topbar-label">Wearable Bracelet</span>
            </div>
            <div class="topbar-right">
                <span class="topbar-chip" id="poly-count">-- tris</span>
                <span class="topbar-chip">v1.0</span>
            </div>
        </nav>

        <!-- 3D Viewport -->
        <section class="viewport">
            <canvas id="viewer"></canvas>
            <div class="loader" id="loader">
                <div class="loader-ring"></div>
                <div class="loader-pct" id="loader-pct">0%</div>
                <div class="loader-label">Loading Bracelet</div>
            </div>
            <div class="hero-overlay">
                <div class="hero-badge"><span class="hero-badge-dot"></span>Interactive 3D</div>
                <h1 class="hero-title">Wear Your<br><em>Rhythm.</em></h1>
                <p class="hero-desc">12 subsystems. 4 IBC electrodes. Your body becomes the network. The DANZ bracelet is precision-engineered wearable hardware that tracks, connects, and rewards movement.</p>
                <div class="hero-metrics">
                    <div><div class="metric-val">42mm</div><div class="metric-label">Case Height</div></div>
                    <div><div class="metric-val">22mm</div><div class="metric-label">Band Width</div></div>
                    <div><div class="metric-val">10mm</div><div class="metric-label">Profile</div></div>
                    <div><div class="metric-val">38g</div><div class="metric-label">Weight</div></div>
                </div>
            </div>
        </section>

        <!-- Mode Controls -->
        <div class="modes">
            <button class="mode-btn" id="mode-explode" title="Explode View">
                <span class="mode-tip">EXPLODE</span>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 8L3 3M16 8l5-5M8 16l-5 5M16 16l5 5"/><rect x="8" y="8" width="8" height="8" rx="1"/></svg>
            </button>
            <button class="mode-btn" id="mode-wireframe" title="Wireframe">
                <span class="mode-tip">WIREFRAME</span>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l10 6v8l-10 6L2 16V8l10-6z"/><path d="M12 22V10M2 8l10 4 10-4"/></svg>
            </button>
            <button class="mode-btn" id="mode-xray" title="X-Ray">
                <span class="mode-tip">X-RAY</span>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 2a10 10 0 000 20"/><path d="M2 12h20"/></svg>
            </button>
            <button class="mode-btn on" id="mode-rotate" title="Auto-Rotate">
                <span class="mode-tip">ROTATE</span>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 11-6.22-8.56"/><polyline points="21 3 21 9 15 9"/></svg>
            </button>
            <button class="mode-btn" id="mode-color" title="Colors">
                <span class="mode-tip">COLORS</span>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="8" r="2" fill="currentColor"/><circle cx="8" cy="14" r="2" fill="currentColor"/><circle cx="16" cy="14" r="2" fill="currentColor"/></svg>
            </button>
        </div>

        <!-- Color Picker -->
        <div class="color-picker" id="color-picker">
            <span class="color-label">BAND</span>
            <div class="color-swatch on" style="background:#1a1a2a" data-color="0x1a1a2a" title="Midnight"></div>
            <div class="color-swatch" style="background:#ec4899" data-color="0xec4899" title="DANZ Pink"></div>
            <div class="color-swatch" style="background:#a855f7" data-color="0xa855f7" title="Purple"></div>
            <div class="color-swatch" style="background:#06b6d4" data-color="0x06b6d4" title="Cyan"></div>
            <div class="color-swatch" style="background:#22c55e" data-color="0x22c55e" title="Green"></div>
            <div class="color-swatch" style="background:#f5f5f0" data-color="0xf5f5f0" title="Cloud"></div>
        </div>

        <!-- Component Dock -->
        <div class="dock" id="dock"></div>

        <!-- Detail Panel -->
        <div class="panel" id="panel">
            <div class="panel-head">
                <button class="panel-x" id="panel-x">&times;</button>
                <div class="panel-cat" id="p-cat"></div>
                <div class="panel-title" id="p-title"></div>
                <div class="panel-id" id="p-id"></div>
            </div>
            <div class="panel-body" id="p-body"></div>
        </div>

        <!-- Toast -->
        <div class="toast" id="toast"></div>

        <!-- Scroll Content -->
        <div class="sections">
            <section class="sec">
                <div class="sec-head">
                    <h2>Precision <em>Engineering</em></h2>
                    <p>Every millimeter is accounted for. 12 subsystems packed into a bracelet you'd actually want to wear.</p>
                </div>
                <div class="spec-grid" id="spec-grid"></div>
            </section>

            <section class="sec">
                <div class="fun-banner reveal">
                    <div class="fun-emoji">&#x1F483;</div>
                    <h3>Dance to Earn. Literally.</h3>
                    <p>The 6-axis IMU samples your movement 50 times per second. Every salsa spin, every hip-hop pop, every bachata step is captured, verified on-chain, and rewarded with $DANZ tokens. Your body is the miner.</p>
                </div>
            </section>

            <section class="sec">
                <div class="sec-head">
                    <h2>Physical <em>Details</em></h2>
                    <p>Designed for comfort and durability across every dance style</p>
                </div>
                <div class="phys-grid">
                    <div class="phys-card reveal">
                        <h3><span style="font-size:20px">&#x1F4D0;</span> Dimensions</h3>
                        <div class="phys-row"><span class="phys-k">Case Height</span><span class="phys-v" style="color:var(--pink)">42.0 mm</span></div>
                        <div class="phys-row"><span class="phys-k">Case Width</span><span class="phys-v" style="color:var(--pink)">22.2 mm</span></div>
                        <div class="phys-row"><span class="phys-k">Case Depth</span><span class="phys-v" style="color:var(--pink)">10.0 mm</span></div>
                        <div class="phys-row"><span class="phys-k">Band Width</span><span class="phys-v">22.0 mm</span></div>
                        <div class="phys-row"><span class="phys-k">Band Thickness</span><span class="phys-v">2.8 mm</span></div>
                        <div class="phys-row"><span class="phys-k">Wrist Range</span><span class="phys-v">145 - 210 mm</span></div>
                        <div class="phys-row"><span class="phys-k">Total Weight</span><span class="phys-v" style="color:var(--cyan)">~38 g</span></div>
                    </div>
                    <div class="phys-card reveal">
                        <h3><span style="font-size:20px">&#x2699;</span> Materials</h3>
                        <div class="phys-row"><span class="phys-k">Case</span><span class="phys-v">Anodized Al 6061-T6</span></div>
                        <div class="phys-row"><span class="phys-k">Band</span><span class="phys-v">Medical-grade Silicone</span></div>
                        <div class="phys-row"><span class="phys-k">Electrodes</span><span class="phys-v">Gold-plated Copper</span></div>
                        <div class="phys-row"><span class="phys-k">Glass</span><span class="phys-v">Sapphire Crystal (Top)</span></div>
                        <div class="phys-row"><span class="phys-k">Clasp</span><span class="phys-v">Titanium Quick-Release</span></div>
                        <div class="phys-row"><span class="phys-k">Water Rating</span><span class="phys-v" style="color:var(--cyan)">IP67</span></div>
                        <div class="phys-row"><span class="phys-k">Finish</span><span class="phys-v">Micro-blasted Matte</span></div>
                    </div>
                    <div class="phys-card reveal">
                        <h3><span style="font-size:20px">&#x26A1;</span> Power</h3>
                        <div class="phys-row"><span class="phys-k">Battery</span><span class="phys-v">200 mAh LiPo</span></div>
                        <div class="phys-row"><span class="phys-k">Runtime</span><span class="phys-v" style="color:var(--green)">8+ hours active</span></div>
                        <div class="phys-row"><span class="phys-k">Standby</span><span class="phys-v" style="color:var(--green)">72 hours</span></div>
                        <div class="phys-row"><span class="phys-k">Charging</span><span class="phys-v">USB-C (5V / 500mA)</span></div>
                        <div class="phys-row"><span class="phys-k">Full Charge</span><span class="phys-v">~25 minutes</span></div>
                        <div class="phys-row"><span class="phys-k">SoC Sleep</span><span class="phys-v">2.5 uA</span></div>
                        <div class="phys-row"><span class="phys-k">Protection</span><span class="phys-v">OVP / OCP / OTP</span></div>
                    </div>
                    <div class="phys-card reveal">
                        <h3><span style="font-size:20px">&#x1F4E1;</span> Connectivity</h3>
                        <div class="phys-row"><span class="phys-k">BLE</span><span class="phys-v" style="color:var(--cyan)">5.3 LESC</span></div>
                        <div class="phys-row"><span class="phys-k">NFC</span><span class="phys-v">Type 2 Tag (passive)</span></div>
                        <div class="phys-row"><span class="phys-k">IBC</span><span class="phys-v" style="color:var(--pink)">Galvanic 1 Mbps</span></div>
                        <div class="phys-row"><span class="phys-k">USB</span><span class="phys-v">2.0 FS (12 Mbps)</span></div>
                        <div class="phys-row"><span class="phys-k">OTA DFU</span><span class="phys-v">SMP / mcumgr</span></div>
                        <div class="phys-row"><span class="phys-k">Debug</span><span class="phys-v">CDC-ACM Serial</span></div>
                        <div class="phys-row"><span class="phys-k">Range (BLE)</span><span class="phys-v">10+ meters</span></div>
                    </div>
                </div>
            </section>

            <section class="sec">
                <div class="fun-banner reveal">
                    <div class="fun-emoji">&#x1F91D;</div>
                    <h3>Bump to Connect</h3>
                    <p>Fist-bump another DANZ wearer and your bracelets exchange identity tokens through your bodies using galvanic IBC. No Bluetooth pairing screens. No QR codes. Just touch. The future of social connection is literally at your fingertips.</p>
                </div>
            </section>
        </div>

        <footer class="foot">
            <div class="foot-logo">DANZ</div>
            <p>&copy; 2026 FlowBond. All rights reserved.</p>
            <p class="foot-tech">PRECISION WEARABLE HARDWARE &middot; nRF5340 &middot; GALVANIC IBC &middot; DANCE-TO-EARN</p>
        </footer>
    </div>

    <script type="importmap">
    { "imports": {
        "three": "https://unpkg.com/three@0.162.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.162.0/examples/jsm/"
    }}
    </script>
    <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

    /* ── Component Data ── */
    const C = {
        soc:     { name: 'nRF5340 SoC',       cat: 'CORE PROCESSOR',  id: 'PRIMARY SoC',  color: '#7c3aed', mesh: 'nRF5340_SoC',      prio: 'P0', desc: 'Dual-core ARM Cortex-M33 running Zephyr RTOS. App core at 128\u202fMHz handles sensor fusion and IBC protocol. Net core at 64\u202fMHz manages BLE 5.3 stack.', blocks:[{t:'Processor',rows:[['Architecture','ARM Cortex-M33'],['App Core','128 MHz'],['Net Core','64 MHz'],['Flash','1 MB + 256 KB'],['RAM','512 KB + 64 KB'],['RTOS','Zephyr 3.x']]},{t:'Dev Stack',rows:[['IDE','Platform.IO'],['SDK','nRF Connect'],['Debugger','J-Link / SWD']]}], chips:['ARM Cortex-M33','Zephyr','Platform.IO','nRF Connect'] },
        imu:     { name: '6-Axis IMU',         cat: 'MOTION SENSOR',   id: 'FR-01',         color: '#22c55e', mesh: 'IMU_ICM42688',     prio: 'P0', desc: 'ICM-42688-P with 3-axis accelerometer + gyroscope. FIFO buffering at 50\u202fHz with interrupt-driven wakeup. This is the dance movement capture core.', blocks:[{t:'Accelerometer',rows:[['Range','\u00b12g to \u00b116g'],['Noise','70 \u00b5g/\u221aHz'],['Mode','Low-power']]},{t:'Gyroscope',rows:[['Range','\u00b1250\u20132000 dps'],['Noise','3.8 mdps/\u221aHz'],['Interface','SPI @ 24 MHz']]},{t:'Motion',rows:[['FIFO','4 KB'],['Sample Rate','50 Hz'],['Wake','Interrupt-driven']]}], chips:['ICM-42688-P','SPI','FIFO'] },
        touch:   { name: 'Capacitive Touch',   cat: 'SKIN SENSOR',     id: 'FR-02',         color: '#94a3b8', mesh: 'CapTouch_Pad_1',   prio: 'P0', desc: 'On-body detection and gesture recognition within 500\u202fms. Dual pads on skin side detect wear state and swipe gestures.', blocks:[{t:'Specs',rows:[['Type','Self-capacitive'],['Pads','2 (upper / lower)'],['Response','<500 ms'],['Interface','nRF5340 COMP'],['Gestures','Tap, Double-tap, Swipe']]}], chips:['AT42QT','nRF5340 COMP'] },
        haptic:  { name: 'Haptic Motor',       cat: 'FEEDBACK',        id: 'FR-08',         color: '#8b5cf6', mesh: 'Haptic_LRA_Motor', prio: 'P1', desc: 'Linear Resonant Actuator with DRV2605L driver. 6 configurable patterns for dance beat sync, IBC confirmations, and alerts.', blocks:[{t:'Motor',rows:[['Type','LRA (Linear Resonant)'],['Driver','DRV2605L'],['Voltage','1.8V RMS'],['Patterns','6 custom'],['Response','<15 ms']]},{t:'Use Cases',rows:[['Beat Sync','Rhythm haptics'],['IBC Confirm','Bump feedback'],['Alert','Low battery / SOS']]}], chips:['DRV2605L','LRA','I2C'] },
        ble:     { name: 'BLE 5.3 Radio',      cat: 'WIRELESS',        id: 'FR-04',         color: '#06b6d4', mesh: 'BLE_53_Antenna',   prio: 'P0', desc: 'Integrated BLE 5.3 on the net core. GATT server with custom dance movement service. LESC pairing. OTA firmware updates via SMP/mcumgr.', blocks:[{t:'Radio',rows:[['Version','BLE 5.3'],['TX Power','+3 dBm'],['Range','10+ meters'],['Latency','<100 ms']]},{t:'Services',rows:[['GATT','Dance Movement Service'],['Pairing','LESC (Secure)'],['OTA','SMP / mcumgr'],['Profiles','HRS, DIS, Custom']]}], chips:['BLE 5.3','GATT','LESC'] },
        nfc:     { name: 'NFC-A Tag',          cat: 'NEAR FIELD',      id: 'FR-06',         color: '#3b82f6', mesh: 'NFC_Antenna_Loop', prio: 'P1', desc: 'Passive NFC-A Type 2 Tag with PCB trace antenna. Tap your phone to pair, share identity, or verify dance achievements.', blocks:[{t:'NFC',rows:[['Type','NFC-A / Type 2'],['Mode','Passive (no battery)'],['Records','NDEF URL + App Launch'],['Antenna','PCB trace loop'],['Read Range','~3 cm']]}], chips:['NFC-A','NDEF'] },
        ibc:     { name: 'Galvanic IBC',       cat: 'INTRA-BODY',      id: 'FR-07',         color: '#ec4899', mesh: 'IBC_TX_Plus',      prio: 'P1', desc: 'The magic. Differential galvanic coupling sends data through your skin at up to 1\u202fMbps. Fist-bump another wearer to exchange tokens. Your body IS the network.', blocks:[{t:'Physical',rows:[['Frequency','100 kHz \u2013 2 MHz'],['Data Rate','Up to 1 Mbps'],['Modulation','ASK / FSK / OOK'],['Electrodes','4 (TX+/TX\u2212, RX+/RX\u2212)'],['Electrode Material','Gold-plated Cu']]},{t:'Protocol',rows:[['Frame','Preamble + ID + Payload + CRC16'],['Access','CSMA/CA'],['Safety','<1V peak, AC-coupled'],['Current','<100 \u00b5A through skin']]}], chips:['Galvanic','Si5351','CRC16','CSMA/CA'] },
        temp:    { name: 'AHT10 Sensor',       cat: 'ENVIRONMENT',     id: 'FR-03',         color: '#f59e0b', mesh: 'AHT10_TempHumid',  prio: 'P0', desc: 'Skin temperature and humidity monitoring every 10 seconds through micro-vents in the case. Detects workout intensity from skin temperature delta.', blocks:[{t:'Specs',rows:[['Temp Accuracy','\u00b10.3\u00b0C'],['Humidity','\u00b12% RH'],['Interface','I2C (0x38)'],['Interval','10 seconds'],['Venting','3x 0.8mm micro-holes']]}], chips:['AHT10','I2C'] },
        led:     { name: 'WS2812B RGB',        cat: 'VISUAL OUTPUT',   id: 'FR-09',         color: '#ec4899', mesh: 'WS2812B_RGB_LED',  prio: 'P1', desc: 'Addressable NeoPixel LED visible through the sapphire crystal top. Pulses with dance rhythm, shows battery state, and flashes pink for IBC events.', blocks:[{t:'LED',rows:[['Type','WS2812B NeoPixel'],['Colors','16.7M RGB'],['Protocol','Single-wire @ 800 kHz'],['Visible Through','Sapphire crystal top']]},{t:'Patterns',rows:[['Dance','Rhythm-synced pulse'],['IBC','Pink flash on connect'],['Battery','Green/Amber/Red'],['Idle','Slow breathing pink']]}], chips:['WS2812B','NeoPixel'] },
        usb:     { name: 'USB-C Port',         cat: 'WIRED I/O',       id: 'FR-11',         color: '#14b8a6', mesh: 'USB_C_Port',       prio: 'P2', desc: 'USB 2.0 Full Speed at the bottom edge. Firmware DFU, serial debug console (CDC-ACM), and 5V/500mA charging. IP67-rated rubber plug.', blocks:[{t:'USB',rows:[['Speed','12 Mbps (Full Speed)'],['Connector','USB-C'],['Classes','CDC-ACM + DFU'],['Charging','5V / 500mA'],['Protection','IP67 rubber plug']]}], chips:['USB 2.0','CDC-ACM'] },
        battery: { name: '200mAh LiPo',        cat: 'POWER',           id: 'NFR',           color: '#ef4444', mesh: 'LiPo_200mAh',      prio: 'P0', desc: 'Compact pouch-cell LiPo battery. 8+ hours of active dance tracking, 72 hours standby. Full charge in ~25 minutes via USB-C.', blocks:[{t:'Battery',rows:[['Chemistry','LiPo (3.7V nominal)'],['Capacity','200 mAh'],['Active Runtime','8+ hours'],['Standby','72 hours'],['Charge Time','~25 min @ 500mA']]},{t:'Protection',rows:[['OVP','Over-voltage @ 4.2V'],['OCP','Over-current @ 600mA'],['OTP','Over-temp @ 60\u00b0C'],['UVP','Under-voltage @ 2.8V']]}], chips:['LiPo','200mAh','BMS'] },
        button:  { name: 'User Button',        cat: 'INPUT',           id: 'FR-10',         color: '#d4a017', mesh: 'User_Button',      prio: 'P0', desc: 'Flush-mount tactile button on the right side. Short press cycles through modes (Dance / Social / Sleep). Long press (3s) toggles power.', blocks:[{t:'Button',rows:[['Type','Tactile, flush-mount'],['GPIO','Active-low, 10k pull-up'],['Debounce','10 ms (software)'],['Short Press','Mode cycle'],['Long (3s)','Power toggle'],['Feel','0.5N actuation']]}], chips:['GPIO','Tactile'] },
    };

    /* ── Spec Cards ── */
    const specCards = [
        { icon: '\u2699', bg: 'linear-gradient(135deg,#a855f7,#7c3aed)', h: 'Dual-Core SoC', p: 'ARM Cortex-M33', val: '128 MHz', color: 'var(--purple)' },
        { icon: '\u27F3', bg: 'linear-gradient(135deg,#22c55e,#16a34a)', h: '6-Axis Motion', p: 'Accel + Gyro FIFO', val: '50 Hz', color: 'var(--green)' },
        { icon: '\u26A1', bg: 'linear-gradient(135deg,#ec4899,#db2777)', h: 'Galvanic IBC', p: 'Body-as-network', val: '1 Mbps', color: 'var(--pink)' },
        { icon: '\u{1F4F6}', bg: 'linear-gradient(135deg,#06b6d4,#0891b2)', h: 'BLE 5.3', p: 'LESC + OTA DFU', val: '10m+', color: 'var(--cyan)' },
        { icon: '\u{1F50B}', bg: 'linear-gradient(135deg,#ef4444,#dc2626)', h: '200mAh LiPo', p: 'USB-C charging', val: '8+ hrs', color: 'var(--red)' },
        { icon: '\u{1F321}', bg: 'linear-gradient(135deg,#f59e0b,#d97706)', h: 'AHT10 Sensor', p: 'Temp + Humidity', val: '\u00b10.3\u00b0C', color: 'var(--amber)' },
        { icon: '\u{1F4A5}', bg: 'linear-gradient(135deg,#8b5cf6,#6d28d9)', h: 'Haptic LRA', p: 'Beat sync feedback', val: '<15ms', color: '#8b5cf6' },
        { icon: '\u{1F7E2}', bg: 'linear-gradient(135deg,#ec4899,#a855f7)', h: 'RGB LED', p: 'Through sapphire top', val: '16.7M', color: 'var(--pink)' },
    ];

    /* ── Toast ── */
    const toastEl = document.getElementById('toast');
    let toastTimer;
    function toast(msg) {
        clearTimeout(toastTimer);
        toastEl.textContent = msg;
        toastEl.classList.add('show');
        toastTimer = setTimeout(() => toastEl.classList.remove('show'), 2200);
    }

    /* ── Fun Messages ── */
    const funMessages = [
        'Your body is now a network node',
        'Dance mining activated',
        'Galvanic link established',
        'Rhythm detected: 128 BPM',
        'IBC handshake: success',
        '$DANZ tokens incoming...',
        'Sapphire crystal: pristine',
        'Haptic beat sync: locked',
        'Skin temp: optimal range',
        'BLE 5.3: connected',
        'NFC tap: identity verified',
    ];

    /* ── Password ── */
    const PW = 'flowbond';
    function auth() {
        const v = document.getElementById('pw').value.toLowerCase();
        if (v === PW) {
            document.getElementById('gate').classList.add('gone');
            document.getElementById('app').classList.add('on');
            localStorage.setItem('fb-auth', '1');
            boot();
        } else {
            document.getElementById('pw-err').classList.add('on');
            document.getElementById('pw').value = '';
            setTimeout(() => document.getElementById('pw-err').classList.remove('on'), 1800);
        }
    }
    document.getElementById('pw').addEventListener('keydown', e => { if (e.key === 'Enter') auth(); });
    document.getElementById('pw-btn').addEventListener('click', auth);
    document.getElementById('pw').focus();
    if (localStorage.getItem('fb-auth') === '1') {
        document.getElementById('gate').classList.add('gone');
        document.getElementById('app').classList.add('on');
        requestAnimationFrame(boot);
    }

    /* ── Build Dock ── */
    const dock = document.getElementById('dock');
    for (const [k, v] of Object.entries(C)) {
        const b = document.createElement('button');
        b.className = 'dock-btn';
        b.dataset.c = k;
        b.innerHTML = `<span class="dock-dot" style="background:${v.color}"></span>${v.name}`;
        dock.appendChild(b);
    }

    /* ── Build Spec Grid ── */
    const sg = document.getElementById('spec-grid');
    specCards.forEach(c => {
        const d = document.createElement('div');
        d.className = 'spec-card reveal';
        d.innerHTML = `<div class="spec-icon" style="background:${c.bg}">${c.icon}</div><h3>${c.h}</h3><p>${c.p}</p><span class="spec-val" style="color:${c.color}">${c.val}</span>`;
        sg.appendChild(d);
    });

    /* ── Panel ── */
    let activeComp = null;
    const panel = document.getElementById('panel');

    function openPanel(key) {
        const c = C[key]; if (!c) return;
        activeComp = key;
        document.getElementById('p-cat').textContent = c.cat;
        document.getElementById('p-title').textContent = c.name;
        document.getElementById('p-id').textContent = c.id;

        let h = `<p class="panel-desc">${c.desc}</p>`;
        if (c.prio) { const pc = c.prio.toLowerCase(); h += `<div class="prio prio-${pc}">${c.prio}</div>`; }
        c.blocks.forEach(b => {
            h += `<div class="sblock"><div class="sblock-title">${b.t}</div>`;
            b.rows.forEach(r => h += `<div class="srow"><span class="srow-k">${r[0]}</span><span class="srow-v">${r[1]}</span></div>`);
            h += '</div>';
        });
        if (c.chips?.length) {
            h += '<div class="sblock"><div class="sblock-title">Parts</div><div class="chips">';
            c.chips.forEach(ch => h += `<span class="chip">${ch}</span>`);
            h += '</div></div>';
        }
        document.getElementById('p-body').innerHTML = h;
        panel.classList.add('open');
        dock.querySelectorAll('.dock-btn').forEach(b => b.classList.toggle('on', b.dataset.c === key));
        highlightMesh(c.mesh);
    }

    function closePanel() {
        activeComp = null;
        panel.classList.remove('open');
        dock.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('on'));
        resetHighlight();
    }

    document.getElementById('panel-x').addEventListener('click', closePanel);
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closePanel(); });
    dock.addEventListener('click', e => {
        const btn = e.target.closest('.dock-btn');
        if (!btn) return;
        const k = btn.dataset.c;
        activeComp === k ? closePanel() : openPanel(k);
    });

    /* ── Three.js Scene ── */
    let scene, camera, renderer, controls, modelGroup, bandMesh, claspGroup;
    let meshMap = {};
    let particleSystem;
    let isExploded = false, isWireframe = false, isXray = false;
    let bandMaterial;

    function boot() {
        const canvas = document.getElementById('viewer');
        const hero = canvas.parentElement;

        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x030305);
        scene.fog = new THREE.FogExp2(0x030305, 6);

        camera = new THREE.PerspectiveCamera(36, hero.clientWidth / hero.clientHeight, 0.001, 100);
        camera.position.set(0.06, 0.05, 0.1);

        renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: false });
        renderer.setSize(hero.clientWidth, hero.clientHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.4;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;

        controls = new OrbitControls(camera, canvas);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 0.025;
        controls.maxDistance = 0.3;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.8;
        controls.target.set(0, 0, 0);
        controls.maxPolarAngle = Math.PI * 0.85;

        // ── Lighting ──
        const ambient = new THREE.AmbientLight(0x303045, 0.4);
        scene.add(ambient);

        const keyLight = new THREE.DirectionalLight(0xffffff, 2.2);
        keyLight.position.set(0.1, 0.12, 0.08);
        keyLight.castShadow = true;
        keyLight.shadow.mapSize.set(1024, 1024);
        keyLight.shadow.camera.near = 0.01;
        keyLight.shadow.camera.far = 0.5;
        keyLight.shadow.radius = 3;
        scene.add(keyLight);

        const fillLight = new THREE.DirectionalLight(0xec4899, 0.4);
        fillLight.position.set(-0.08, 0.05, -0.05);
        scene.add(fillLight);

        const rimLight = new THREE.PointLight(0x06b6d4, 0.5, 0.3);
        rimLight.position.set(-0.04, -0.03, 0.08);
        scene.add(rimLight);

        const underLight = new THREE.PointLight(0xa855f7, 0.25, 0.2);
        underLight.position.set(0, -0.06, -0.02);
        scene.add(underLight);

        const topAccent = new THREE.PointLight(0xec4899, 0.3, 0.15);
        topAccent.position.set(0, 0.08, 0);
        scene.add(topAccent);

        // ── Ground plane (subtle reflection) ──
        const groundGeo = new THREE.PlaneGeometry(0.4, 0.4);
        const groundMat = new THREE.MeshStandardMaterial({
            color: 0x050508, roughness: 0.85, metalness: 0.1,
            transparent: true, opacity: 0.6
        });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = -0.035;
        ground.receiveShadow = true;
        scene.add(ground);

        // ── Grid ──
        const grid = new THREE.GridHelper(0.3, 40, 0x12121e, 0x0a0a12);
        grid.position.y = -0.034;
        scene.add(grid);

        // ── Particle system (floating dust) ──
        createParticles();

        // ── Build bracelet band ──
        createBand();

        // ── Load GLB model ──
        new GLTFLoader().load('flowbond-wearable-final.glb',
            gltf => {
                modelGroup = gltf.scene;

                const box = new THREE.Box3().setFromObject(modelGroup);
                const center = box.getCenter(new THREE.Vector3());
                modelGroup.position.sub(center);
                scene.add(modelGroup);

                let totalTris = 0;
                modelGroup.traverse(child => {
                    if (child.isMesh) {
                        meshMap[child.name] = child;
                        child.userData.originalMaterial = child.material;
                        child.userData.originalPosition = child.position.clone();
                        child.castShadow = true;
                        child.receiveShadow = true;
                        if (child.geometry.index) totalTris += child.geometry.index.count / 3;
                    }
                });

                // Make DANZ case semi-transparent with nicer material
                const caseMesh = meshMap['DANZ_Case'];
                if (caseMesh) {
                    const mat = new THREE.MeshPhysicalMaterial({
                        color: 0xd94c8a,
                        metalness: 0.7,
                        roughness: 0.15,
                        transparent: true,
                        opacity: 0.28,
                        transmission: 0.6,
                        thickness: 0.5,
                        ior: 1.5,
                        clearcoat: 1.0,
                        clearcoatRoughness: 0.05,
                        side: THREE.DoubleSide,
                        depthWrite: false,
                        envMapIntensity: 1.5,
                    });
                    caseMesh.material = mat;
                    caseMesh.userData.originalMaterial = mat;
                    caseMesh.renderOrder = 999;
                }

                document.getElementById('poly-count').textContent = `${Math.round(totalTris).toLocaleString()} tris`;
                document.getElementById('loader').classList.add('gone');

                // Fun toast on load
                setTimeout(() => toast(funMessages[Math.floor(Math.random() * funMessages.length)]), 1500);
            },
            p => {
                if (p.total > 0) {
                    const pct = Math.round((p.loaded / p.total) * 100);
                    document.getElementById('loader-pct').textContent = `${pct}%`;
                }
            },
            err => {
                console.error(err);
                document.getElementById('loader-pct').textContent = 'ERR';
            }
        );

        // ── Raycaster ──
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let pointerDown = new THREE.Vector2();

        canvas.addEventListener('pointerdown', e => {
            pointerDown.set(e.clientX, e.clientY);
        });

        canvas.addEventListener('pointerup', e => {
            const dx = e.clientX - pointerDown.x;
            const dy = e.clientY - pointerDown.y;
            if (Math.sqrt(dx*dx + dy*dy) > 5) return; // was a drag

            if (!modelGroup) return;
            const rect = canvas.getBoundingClientRect();
            mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const hits = raycaster.intersectObjects(modelGroup.children, true);
            if (hits.length) {
                const name = hits[0].object.name;
                for (const [k, v] of Object.entries(C)) {
                    if (v.mesh === name || name.startsWith(v.mesh?.split('_')[0])) {
                        openPanel(k);
                        return;
                    }
                }
            }
        });

        // ── Resize ──
        window.addEventListener('resize', () => {
            camera.aspect = hero.clientWidth / hero.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(hero.clientWidth, hero.clientHeight);
        });

        // ── Random fun toasts ──
        setInterval(() => {
            if (!activeComp && Math.random() < 0.3) {
                toast(funMessages[Math.floor(Math.random() * funMessages.length)]);
            }
        }, 12000);

        animate();
    }

    /* ── Procedural Bracelet Band ── */
    function createBand() {
        const wristRadius = 0.027; // ~27mm radius (170mm circumference)
        const bandWidth = 0.011;   // 11mm half-width
        const bandThick = 0.0014;  // 1.4mm thickness
        const segments = 128;
        const arcAngle = Math.PI * 1.25; // ~225 degrees of band visible
        const startAngle = Math.PI * 0.55;

        bandMaterial = new THREE.MeshPhysicalMaterial({
            color: 0x1a1a2a,
            roughness: 0.65,
            metalness: 0.05,
            clearcoat: 0.3,
            clearcoatRoughness: 0.4,
        });

        // Band — extruded along arc
        const bandShape = new THREE.Shape();
        bandShape.moveTo(-bandWidth, -bandThick / 2);
        bandShape.lineTo(bandWidth, -bandThick / 2);
        bandShape.quadraticCurveTo(bandWidth + 0.0005, 0, bandWidth, bandThick / 2);
        bandShape.lineTo(-bandWidth, bandThick / 2);
        bandShape.quadraticCurveTo(-bandWidth - 0.0005, 0, -bandWidth, -bandThick / 2);

        const path = new THREE.CurvePath();
        const points = [];
        for (let i = 0; i <= segments; i++) {
            const angle = startAngle + (i / segments) * arcAngle;
            points.push(new THREE.Vector3(
                Math.cos(angle) * wristRadius,
                Math.sin(angle) * wristRadius,
                0
            ));
        }
        const curve = new THREE.CatmullRomCurve3(points, false);

        const extrudeSettings = {
            steps: segments,
            extrudePath: curve,
        };

        const bandGeo = new THREE.ExtrudeGeometry(bandShape, extrudeSettings);
        bandMesh = new THREE.Mesh(bandGeo, bandMaterial);
        bandMesh.castShadow = true;
        bandMesh.receiveShadow = true;
        scene.add(bandMesh);

        // ── Band texture grooves (tiny indentations for grip) ──
        const grooveCount = 18;
        const grooveMat = new THREE.MeshStandardMaterial({
            color: 0x0e0e1a, roughness: 0.9, metalness: 0,
        });
        for (let i = 1; i < grooveCount; i++) {
            const t = i / grooveCount;
            const angle = startAngle + t * arcAngle;
            const x = Math.cos(angle) * (wristRadius + bandThick * 0.3);
            const y = Math.sin(angle) * (wristRadius + bandThick * 0.3);

            const groove = new THREE.Mesh(
                new THREE.BoxGeometry(0.0002, 0.0002, bandWidth * 1.6),
                grooveMat
            );
            groove.position.set(x, y, 0);
            groove.rotation.z = angle + Math.PI / 2;
            scene.add(groove);
        }

        // ── Clasp (titanium quick-release) ──
        claspGroup = new THREE.Group();
        const claspMat = new THREE.MeshPhysicalMaterial({
            color: 0x8a8a9a,
            metalness: 0.9,
            roughness: 0.2,
            clearcoat: 0.5,
        });

        // Clasp body
        const claspBody = new THREE.Mesh(
            new THREE.BoxGeometry(0.006, 0.003, bandWidth * 1.8),
            claspMat
        );

        // Clasp button
        const claspBtn = new THREE.Mesh(
            new THREE.CylinderGeometry(0.001, 0.001, 0.002, 16),
            new THREE.MeshPhysicalMaterial({ color: 0xec4899, metalness: 0.7, roughness: 0.15 })
        );
        claspBtn.rotation.x = Math.PI / 2;
        claspBtn.position.set(0, 0.002, 0);

        claspGroup.add(claspBody);
        claspGroup.add(claspBtn);

        // Position clasp at the end of the band
        const claspAngle = startAngle + arcAngle + 0.08;
        claspGroup.position.set(
            Math.cos(claspAngle) * wristRadius,
            Math.sin(claspAngle) * wristRadius,
            0
        );
        claspGroup.rotation.z = claspAngle + Math.PI / 2;
        scene.add(claspGroup);
    }

    /* ── Particles ── */
    function createParticles() {
        const count = 200;
        const positions = new Float32Array(count * 3);
        const colors = new Float32Array(count * 3);
        const sizes = new Float32Array(count);

        const pinkColor = new THREE.Color(0xec4899);
        const purpleColor = new THREE.Color(0xa855f7);
        const cyanColor = new THREE.Color(0x06b6d4);

        for (let i = 0; i < count; i++) {
            positions[i * 3] = (Math.random() - 0.5) * 0.3;
            positions[i * 3 + 1] = (Math.random() - 0.5) * 0.2;
            positions[i * 3 + 2] = (Math.random() - 0.5) * 0.3;
            sizes[i] = Math.random() * 0.0008 + 0.0002;

            const c = [pinkColor, purpleColor, cyanColor][Math.floor(Math.random() * 3)];
            colors[i * 3] = c.r;
            colors[i * 3 + 1] = c.g;
            colors[i * 3 + 2] = c.b;
        }

        const geo = new THREE.BufferGeometry();
        geo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        geo.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

        const mat = new THREE.PointsMaterial({
            size: 0.0006,
            vertexColors: true,
            transparent: true,
            opacity: 0.35,
            blending: THREE.AdditiveBlending,
            depthWrite: false,
            sizeAttenuation: true,
        });

        particleSystem = new THREE.Points(geo, mat);
        scene.add(particleSystem);
    }

    /* ── Mesh Highlighting ── */
    function highlightMesh(meshName) {
        if (!modelGroup) return;
        modelGroup.traverse(child => {
            if (!child.isMesh) return;
            if (child.name === 'DANZ_Case') return;

            const isTarget = child.name === meshName || child.name.startsWith(meshName?.split('_')[0] || '___');

            if (isTarget) {
                const mat = child.userData.originalMaterial?.clone() || child.material.clone();
                mat.emissive = new THREE.Color(0xffffff);
                mat.emissiveIntensity = 0.5;
                child.material = mat;
            } else {
                const mat = child.userData.originalMaterial?.clone() || child.material.clone();
                mat.transparent = true;
                mat.opacity = 0.12;
                child.material = mat;
            }
        });
    }

    function resetHighlight() {
        if (!modelGroup) return;
        modelGroup.traverse(child => {
            if (child.isMesh && child.userData.originalMaterial) {
                child.material = child.userData.originalMaterial;
            }
        });
    }

    /* ── View Modes ── */

    // Explode
    document.getElementById('mode-explode').addEventListener('click', () => {
        isExploded = !isExploded;
        document.getElementById('mode-explode').classList.toggle('on', isExploded);
        if (!modelGroup) return;

        const center = new THREE.Vector3(0, 0, 0);
        modelGroup.traverse(child => {
            if (!child.isMesh) return;
            const origPos = child.userData.originalPosition;
            if (!origPos) return;

            if (isExploded) {
                const dir = origPos.clone().sub(center).normalize();
                const dist = child.name === 'DANZ_Case' ? 0.012 : 0.008;
                child.position.copy(origPos.clone().add(dir.multiplyScalar(dist)));
            } else {
                child.position.copy(origPos);
            }
        });
        toast(isExploded ? 'Exploded view: components separated' : 'Assembled view');
    });

    // Wireframe
    document.getElementById('mode-wireframe').addEventListener('click', () => {
        isWireframe = !isWireframe;
        document.getElementById('mode-wireframe').classList.toggle('on', isWireframe);
        if (!modelGroup) return;

        modelGroup.traverse(child => {
            if (!child.isMesh) return;
            child.material.wireframe = isWireframe;
        });
        if (bandMesh) bandMesh.material.wireframe = isWireframe;
        toast(isWireframe ? 'Wireframe mode' : 'Solid mode');
    });

    // X-Ray
    document.getElementById('mode-xray').addEventListener('click', () => {
        isXray = !isXray;
        document.getElementById('mode-xray').classList.toggle('on', isXray);
        if (!modelGroup) return;

        const caseMesh = meshMap['DANZ_Case'];
        if (caseMesh) {
            if (isXray) {
                caseMesh.material.opacity = 0.06;
                caseMesh.material.transmission = 0.95;
            } else {
                caseMesh.material.opacity = 0.28;
                caseMesh.material.transmission = 0.6;
            }
        }

        modelGroup.traverse(child => {
            if (!child.isMesh || child.name === 'DANZ_Case') return;
            if (isXray) {
                const mat = child.userData.originalMaterial?.clone() || child.material.clone();
                mat.emissive = new THREE.Color(mat.color || 0xffffff);
                mat.emissiveIntensity = 0.6;
                child.material = mat;
            } else if (child.userData.originalMaterial) {
                child.material = child.userData.originalMaterial;
            }
        });
        toast(isXray ? 'X-Ray: see through the case' : 'Normal view');
    });

    // Auto-Rotate
    document.getElementById('mode-rotate').addEventListener('click', () => {
        controls.autoRotate = !controls.autoRotate;
        document.getElementById('mode-rotate').classList.toggle('on', controls.autoRotate);
        toast(controls.autoRotate ? 'Auto-rotate on' : 'Auto-rotate off');
    });

    // Color Picker Toggle
    document.getElementById('mode-color').addEventListener('click', () => {
        const cp = document.getElementById('color-picker');
        cp.classList.toggle('on');
        document.getElementById('mode-color').classList.toggle('on', cp.classList.contains('on'));
    });

    // Color Swatches
    document.querySelectorAll('.color-swatch').forEach(sw => {
        sw.addEventListener('click', () => {
            const hex = parseInt(sw.dataset.color);
            if (bandMaterial) {
                bandMaterial.color.setHex(hex);
            }
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('on'));
            sw.classList.add('on');
            toast(`Band color: ${sw.title}`);
        });
    });

    /* ── Animation Loop ── */
    const clock = new THREE.Clock();

    function animate() {
        requestAnimationFrame(animate);
        const t = clock.getElapsedTime();

        controls.update();

        // Particle float
        if (particleSystem) {
            const pos = particleSystem.geometry.attributes.position;
            for (let i = 0; i < pos.count; i++) {
                pos.array[i * 3 + 1] += Math.sin(t * 0.5 + i) * 0.000003;
                pos.array[i * 3] += Math.cos(t * 0.3 + i * 0.7) * 0.000002;
            }
            pos.needsUpdate = true;
            particleSystem.rotation.y = t * 0.02;
        }

        // LED glow pulse
        const ledMesh = meshMap['WS2812B_RGB_LED'];
        if (ledMesh && ledMesh.material.emissiveIntensity !== undefined) {
            const pulse = 0.8 + Math.sin(t * 3) * 0.5;
            if (!activeComp || activeComp === 'led') {
                ledMesh.material.emissiveIntensity = pulse;
            }
        }

        renderer.render(scene, camera);
    }

    /* ── Scroll Reveal ── */
    const obs = new IntersectionObserver(entries => {
        entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('vis'); });
    }, { threshold: 0.1, rootMargin: '0px 0px -30px 0px' });
    document.querySelectorAll('.reveal').forEach(el => obs.observe(el));
    </script>
</body>
</html>
